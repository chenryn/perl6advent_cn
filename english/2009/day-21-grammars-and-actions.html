<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">

<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Day 21, Grammars and Actions | Perl 6 Advent Calendar</title>
<link rel="pingback" href="https://perl6advent.wordpress.com/xmlrpc.php" />
<meta name="google-site-verification" content="YPNxtMSK3Jj7JR2XCK-hDqmF9xDIeBEyvYm3aT1s71Y" />
<link rel="alternate" type="application/rss+xml" title="Perl 6 Advent Calendar &raquo; Feed" href="https://perl6advent.wordpress.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Perl 6 Advent Calendar &raquo; Comments Feed" href="https://perl6advent.wordpress.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Perl 6 Advent Calendar &raquo; Day 21, Grammars and&nbsp;Actions Comments Feed" href="https://perl6advent.wordpress.com/2009/12/21/day-21-grammars-and-actions/feed/" />
<script type="text/javascript">
/* <![CDATA[ */
function addLoadEvent(func){var oldonload=window.onload;if(typeof window.onload!='function'){window.onload=func;}else{window.onload=function(){oldonload();func();}}}
/* ]]> */
</script>
<link rel='stylesheet' id='all-css-0' href='https://s0.wp.com/_static/??-eJx9j90OgjAMRl/I2Yjiz4XxWcZWx6CjC+tCfHuHiZFIwl2/5px+KUxRGR4EB4GQVaTs/JCAfI8JOpSoTa8+aW9S2sECb4jdT2Dn0HIW9WQinmDy1qGspEXHiKQFrYqc5C9taYZHLPsQtcxEQOs1EoaCbWkhnr/WPLblr3WNtOVOgpgb6HMzetNDkhfhDD7C/XC8XarqdK3r7g1dsHQ6' type='text/css' media='all' />
<!--[if lte IE 8]>
<link rel='stylesheet' id='kubrick-ie-css'  href='https://s0.wp.com/wp-content/themes/pub/kubrick/ie.css?m=1273203575g&#038;ver=3.9-RC1' type='text/css' media='all' />
<![endif]-->
<link rel='stylesheet' id='all-css-2' href='https://s0.wp.com/_static/??-eJxljEsKgDAMBS9kjX9wIZ5F2xArbSOm4vWtrgru3sCbgftQmkPEEMFf6nAX2SBw4uqY0iTQkmOZsIBMiht6FNg6IMfr4n6HrHpbQxjlSxKzOXEx8gqzn+p2rPqh6ep2fwA3cTYI' type='text/css' media='all' />
<link rel='stylesheet' id='print-css-2' href='https://s0.wp.com/wp-content/mu-plugins/global-print/global-print.css?m=1387483371g' type='text/css' media='print' />
<script type='text/javascript'>
/* <![CDATA[ */
var LoggedOutFollow = {"invalid_email":"Your subscription did not succeed, please try again with a valid email address."};
/* ]]> */
</script>
<script type='text/javascript' src='https://s0.wp.com/_static/??-eJyFj0kOwjAMRS+ESVEX0AXiLG3jRg6ZiBMiOD2pBAgKUlee3ve3RQkwepfQJaFZWD+QQciMsVe1B+Qmv9W8EZUjN5oskWdQXzLG2zOsAmBJxT7h1pJ7wR+uwXOyyFwt/0y/rchdCcsqpjGFfjxDRKb7z9bBeAXBZEWORc0VSp8TTN4YX0QhqTAtNTa/FRFNfUbCfPeiqqqTPe7abt8cuqbt9ANnG4Rf'></script>
<link rel='stylesheet' id='all-css-0' href='https://s2.wp.com/wp-content/mu-plugins/highlander-comments/style.css?m=1377793621g' type='text/css' media='all' />
<!--[if lt IE 8]>
<link rel='stylesheet' id='highlander-comments-ie7-css'  href='https://s2.wp.com/wp-content/mu-plugins/highlander-comments/style-ie7.css?m=1351637563g&#038;ver=20110606' type='text/css' media='all' />
<![endif]-->
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://perl6advent.wordpress.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://perl6advent.wordpress.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Day 20: Little big&nbsp;things' href='https://perl6advent.wordpress.com/2009/12/20/day-20-little-big-things/' />
<link rel='next' title='Day 22: Operator&nbsp;Overloading' href='https://perl6advent.wordpress.com/2009/12/22/day-22-operator-overloading/' />
<meta name="generator" content="WordPress.com" />
<link rel='canonical' href='https://perl6advent.wordpress.com/2009/12/21/day-21-grammars-and-actions/' />
<link rel='shortlink' href='http://wp.me/pJ3YZ-5d' />
<link rel="alternate" type="application/json+oembed" href="https://public-api.wordpress.com/oembed/1.0/?format=json&amp;url=https%3A%2F%2Fperl6advent.wordpress.com%2F2009%2F12%2F21%2Fday-21-grammars-and-actions%2F&amp;for=wpcom-auto-discovery" /><link rel="alternate" type="application/xml+oembed" href="https://public-api.wordpress.com/oembed/1.0/?format=xml&amp;url=https%3A%2F%2Fperl6advent.wordpress.com%2F2009%2F12%2F21%2Fday-21-grammars-and-actions%2F&amp;for=wpcom-auto-discovery" />
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="Day 21, Grammars and Actions" />
<meta property="og:url" content="https://perl6advent.wordpress.com/2009/12/21/day-21-grammars-and-actions/" />
<meta property="og:description" content="In today&#039;s post, we&#039;re going to cover several topics, but primarily grammars. I&#039;d like to use an example inspired by some Perl 5 code I wrote for work recently. So we have a bunch of text that we w..." />
<meta property="article:published_time" content="2009-12-21T00:01:05+00:00" />
<meta property="article:modified_time" content="2014-04-14T19:36:04+00:00" />
<meta property="article:author" content="https://perl6advent.wordpress.com/author/tenebrackets/" />
<meta property="og:site_name" content="Perl 6 Advent Calendar" />
<meta property="og:image" content="http://wordpress.com/i/blank.jpg?m=1383295312g" />
<meta name="twitter:site" content="@wordpressdotcom" />
<meta name="twitter:card" content="summary" />
<meta property="fb:app_id" content="249643311490" />
<meta property="article:publisher" content="https://www.facebook.com/WordPresscom" />
<link rel="shortcut icon" type="image/x-icon" href="https://s2.wp.com/i/favicon.ico" sizes="16x16 24x24 32x32 48x48" />
<link rel="icon" type="image/x-icon" href="https://s2.wp.com/i/favicon.ico" sizes="16x16 24x24 32x32 48x48" />
<link rel="apple-touch-icon-precomposed" href="https://s0.wp.com/i/webclip.png" />
<link rel='openid.server' href='https://perl6advent.wordpress.com/?openidserver=1' />
<link rel='openid.delegate' href='https://perl6advent.wordpress.com/' />
<link rel="search" type="application/opensearchdescription+xml" href="https://perl6advent.wordpress.com/osd.xml" title="Perl 6 Advent Calendar" />
<link rel="search" type="application/opensearchdescription+xml" href="http://wordpress.com/opensearch.xml" title="WordPress.com" />
<style type='text/css'><!--
body { background: url("https://s0.wp.com/wp-content/themes/pub/kubrick/images/kubrickbgcolor.gif"); }
#page { background: url("https://s0.wp.com/wp-content/themes/pub/kubrick/images/kubrickbgwide.gif") repeat-y top !important; border: none; }
#header { background: url("https://s0.wp.com/wp-content/themes/pub/kubrick/images/kubrickheader.gif") no-repeat bottom center; }
#footer { background: url("https://s0.wp.com/wp-content/themes/pub/kubrick/images/kubrickfooter.gif") no-repeat bottom; border: none;}
#header { margin: 0 !important; margin: 0 0 0 1px; padding: 1px; height: 198px; width: 758px; }
#headerimg { margin: 7px 9px 0; height: 192px; width: 740px; }
#headerimg h1 a, #headerimg h1 a:visited, #headerimg .description { color: #FFFFFF; }
#headerimg h1 a, #headerimg .description { display:  }

	--></style><meta name="application-name" content="Perl 6 Advent Calendar" /><meta name="msapplication-window" content="width=device-width;height=device-height" /><meta name="msapplication-tooltip" content="Something cool about Perl 6 every day" /><meta name="msapplication-task" content="name=Subscribe;action-uri=https://perl6advent.wordpress.com/feed/;icon-uri=https://s2.wp.com/i/favicon.ico" /><meta name="msapplication-task" content="name=Sign up for a free blog;action-uri=http://wordpress.com/signup/;icon-uri=https://s2.wp.com/i/favicon.ico" /><meta name="msapplication-task" content="name=WordPress.com Support;action-uri=http://support.wordpress.com/;icon-uri=https://s2.wp.com/i/favicon.ico" /><meta name="msapplication-task" content="name=WordPress.com Forums;action-uri=http://forums.wordpress.com/;icon-uri=https://s2.wp.com/i/favicon.ico" /><meta name="title" content="Day 21, Grammars and&nbsp;Actions | Perl 6 Advent Calendar on WordPress.com" />
<meta name="description" content="In today&#039;s post, we&#039;re going to cover several topics, but primarily grammars. I&#039;d like to use an example inspired by some Perl 5 code I wrote for work recently. So we have a bunch of text that we want to process and deal with. Perl&#039;s supposed to be great at that, right? To be precise,&hellip;" />
<style type="text/css">
#header     { margin: 0 !important; margin: 0 0 0 1px; padding: 1px; height: 198px; width: 758px; }
#headerimg  { margin: 7px 9px 0; height: 192px; width: 740px; }
#headerimg { background: url(https://perl6advent.files.wordpress.com/2009/12/perl6advent2.png) no-repeat top;}
#header h1 a, #header h1 a:hover, #header .description {
	color: #fff;
}
</style>

<script type='text/javascript' src='http://partner.googleadservices.com/gampad/google_service.js'>
</script>
<script type='text/javascript'>
if ( typeof GS_googleAddAdSenseService == 'function' ) { GS_googleAddAdSenseService("ca-pub-3443918307802676"); }
if ( typeof GS_googleEnableAllServices == 'function' ) { GS_googleEnableAllServices() };
</script>
<script type="text/javascript" src="http://c.amazon-adsystem.com/aax2/amzn_ads.js"></script>
<script type="text/javascript">
try { amznads.getAds("3033","300x250"); } catch(e) { /* ignore */ }
</script>
<script type="text/javascript">
var amznKeys = amznads.getKeys();
if (typeof amznKeys != "undefined" && amznKeys != "") { for (var i =0; i < amznKeys.length; i++) { var key = amznKeys[i]; GA_googleAddAttr("amzn", key);} }
document.close();
</script>
<script type='text/javascript'>
if ( typeof GA_googleAddSlot == 'function' ) { GA_googleAddSlot("ca-pub-3443918307802676", "wpcom_below_post"); }
</script>
<script type='text/javascript'>
if ( typeof GA_googleFetchAds == 'function' ) { GA_googleFetchAds(); }
</script>

<script type="text/javascript">
var wpcom_ads = { bid: 10740073, pt: 'permalink', wa: 0, as: 0, domain: 'perl6advent.wordpress.com', url: 'https://perl6advent.wordpress.com/2009/12/21/day-21-grammars-and-actions/', gid: '', };
</script>
<style type="text/css" id="syntaxhighlighteranchor"></style>
<script type="text/javascript">
	window.google_analytics_uacct = "UA-52447-2";
</script>

<script type="text/javascript">
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-52447-2']);
	_gaq.push(['_setDomainName', 'wordpress.com']);
	_gaq.push(['_initData']);
	_gaq.push(['_trackPageview']);

	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
	})();
</script>
</head>
<body class="single single-post postid-323 single-format-standard mp6 highlander-enabled highlander-light">
<div id="page">

<div id="header">
	<div id="headerimg" onclick=" location.href='https://perl6advent.wordpress.com';" style="cursor: pointer;">
		<h1><a href="https://perl6advent.wordpress.com/">Perl 6 Advent Calendar</a></h1>
		<div class="description">Something cool about Perl 6 every day</div>
	</div>
</div>
<hr />

	<div id="content" class="widecolumn">

	
		<div class="navigation">
			<div class="alignleft">&laquo; <a href="https://perl6advent.wordpress.com/2009/12/20/day-20-little-big-things/" rel="prev">Day 20: Little big&nbsp;things</a></div>
			<div class="alignright"><a href="https://perl6advent.wordpress.com/2009/12/22/day-22-operator-overloading/" rel="next">Day 22: Operator&nbsp;Overloading</a> &raquo;</div>
		</div>

		<div class="post-323 post type-post status-publish format-standard hentry category-2009 clear" id="post-323">
			<h2>Day 21, Grammars and&nbsp;Actions</h2>
			<small class="single-by"><span class="by-author"><span class="sep">by</span> <span class="author vcard"><a class="url fn n" href="https://perl6advent.wordpress.com/author/tenebrackets/" title="View all posts by tenebrackets" rel="author">tenebrackets</a></span> </span></small>

			<div class="entry">
				<p>In today&#8217;s post, we&#8217;re going to cover several topics, but primarily grammars.  I&#8217;d like to use an example inspired by some Perl 5 code I wrote for work recently.</p>
<p>So we have a bunch of text that we want to process and deal with.  Perl&#8217;s supposed to be great at that, right?  To be precise, let&#8217;s talk about the following text, describing some questions and their answers:</p>
<pre>pickmany: Which items are food?
    ac: Rice
    ac: Orange
    ac: Mushroom
    ai: Shoes
pickone: Which item is a color?
    ac: Orange
    ai: Shoes
    ai: Mushroom
    ai: Rice</pre>
<p>To parse this in Perl 6, I&#8217;ll start by defining a Grammar.  A Grammar is a special type of namespace for holding regular expressions.  We&#8217;ll also define several named expressions to split up our parsing a bit.</p>
<pre>grammar Question::Grammar {
    token TOP {
        \n*
        &lt;question&gt;+
    }
    token question {
        &lt;header&gt;
        &lt;answer&gt;+
    }
    token header {
        ^^ $&lt;type&gt;=['pickone'|'pickmany'] ':' \s+ $&lt;text&gt;=[\N*] \n
    }
    token answer {
        ^^ \s+ $&lt;correct&gt;=['ac'|'ai'] ':' \s+ $&lt;text&gt;=[\N*] \n
    }
}</pre>
<p>First, a brief overview of what&#8217;s going on here, from a standpoint that assumes you&#8217;re familiar with regular expressions at least a little.  By default in Perl 6 grammars, whitespace is ignored and matches occur over the entire string.  It&#8217;s like the /x and /s Perl 5 modifiers are turned on.  TOP is the regex that&#8217;s called if we try to match against the entire grammar as a whole.</p>
<p>&#8216;token&#8217; is one of three identifiers used to declare a regex, including &#8216;regex&#8217;, &#8216;token&#8217;, and &#8216;rule&#8217;.  &#8216;regex&#8217; is the plain, unmodified version, and the second two just enable some additional options.  &#8216;token&#8217; disables backtracking, and &#8216;rule&#8217; both disables backtracking and causes whitespace in the regex to match literal whitespace in the matched text.  We won&#8217;t use &#8216;rule&#8217;s here.</p>
<p>The &lt;foo&gt; syntax is what&#8217;s used to call another named regex.  &#8216;^^&#8217; is used to match the beginning of a line, as opposed to lone &#8216;^&#8217;, which matches the beginning of the entire matched text.  The square brackets, [], are non-capturing grouping, like (?: ) in Perl 5 regular expressions.</p>
<p>The = syntax is used to assign the RHS into the name specified on the LHS.  You&#8217;ll see what I mean later when we use the result of this regex.</p>
<p>Let&#8217;s see what we get if we try matching against that grammar and printing the result we get back:</p>
<pre>my $text = Q {
pickmany: Which items are food?
    ac: Rice
    ac: Orange
    ac: Mushroom
    ai: Shoes
pickone: Which item is a color?
    ac: Orange
    ai: Shoes
    ai: Mushroom
    ai: Rice
};
my $match = Question::Grammar.parse($text);
say $match.perl;</pre>
<p>Try running that yourself if you like.  It produces 232 lines of output, which is a bit too much to include here.  Let&#8217;s pull out just one part, the questions.</p>
<pre># Print the question
for $match&lt;question&gt;.flat -&gt; $q {
    say $q&lt;header&gt;&lt;text&gt;;
}
We need to use .flat, because $match&lt;question&gt; is an array held in a scalar container.</pre>
<p>As a reminder, postfix &lt;&gt; is the auto-quoting named lookup syntax.  That&#8217;s equivalent to the following, but a little easier to type, and also easier to read:</p>
<pre># Print the question
for $match{'question'}.flat -&gt; $q {
    say $q{'header'}{'text'};
}</pre>
<p>So we can see that a match object contains named items as hash values, and repetitions are stored as an array.  If we had any positional captures, made with parens just like Perl 5: (), they would have been accessed through the positional interface, with postfix [], like an array.</p>
<p>The next step is to make some classes and then populate them from the match object.  First some class definitions:</p>
<pre>class Question::Answer {
    has $.text is rw;
    has Bool $.correct is rw;
}</pre>
<pre>class Question {
    has $.text is rw;
    has $.type is rw;
    has Question::Answer @.answers is rw;
}</pre>
<p>Building Question objects out of the match object isn&#8217;t that bad, but it&#8217;s still not pretty:</p>
<pre>my @questions = $match&lt;question&gt;.map: {
    Question.new(
        text    =&gt; ~$_&lt;header&gt;&lt;text&gt;,
        type    =&gt; ~$_&lt;header&gt;&lt;type&gt;,
        answers =&gt; $_&lt;answer&gt;.map: {
            Question::Answer.new(
                text =&gt; ~$_&lt;text&gt;,
                correct =&gt; ~$_&lt;correct&gt; eq 'ac',
            )
        },
    );
};</pre>
<p>Remembering that any repetition in the regex is reflected as an array in the match object, we map over the &lt;question&gt; attribute, building a Question object for each.  Each &lt;question&gt; match has an array of &lt;answer&gt; matches, so we map over those too, building a list of Question::Answer objects for each one. We are stringifying the values to have strings in our array, rather than a bunch of Match objects.</p>
<p>As you can guess, this approach doesn&#8217;t scale up very well.  A much nicer way to do it is to build the objects as we go. The method used to do this is to pass an object as the :action argument to the .parse() method on the Grammar.  The parsing engine will then call methods on that object with the same name as the regexes being parsed, with the evaluated match object for the rule passed as an argument.  If the method calls &#8216;make()&#8217; during execution, the argument to &#8216;make()&#8217; is set as the &#8216;.ast&#8217; (for &#8220;Abstract Syntax Tree&#8221;) attribute of the match object.</p>
<p>Okay, that&#8217;s a fairly abstract description.  Let&#8217;s see some real code. We need to make a class with methods named the same as those three regexes:</p>
<pre>class Question::Actions {
    method TOP($/) {
        make $&lt;question&gt;».ast;
    }
    method question($/) {
        make Question.new(
            text =&gt; ~$&lt;header&gt;&lt;text&gt;,
            type =&gt; ~$&lt;header&gt;&lt;type&gt;,
            answers =&gt; $&lt;answer&gt;».ast,
        );
    }
    method answer($/) {
        make Question::Answer.new(
            correct =&gt; ~$&lt;correct&gt; eq 'ac',
            text =&gt; ~$&lt;text&gt;,
        );
    }
}</pre>
<p>$/ is the traditional name for match objects, and it&#8217;s as special as $_, in that there&#8217;s special syntax that accesses its attributes.  Named and Positional access without a variable ($&lt;foo&gt; and $[1]) are translated into access to $/ ($/&lt;foo&gt; and $/[1]).  It&#8217;s only a one-character difference, but it saves some visual noise, and helps it fill a semantic space similar to $1, $2, $3, etc. in Perl 5.</p>
<p>In the &#8216;TOP&#8217; method, we just use a hyperoperator method call to make a list of the .ast attributes of each item in $&lt;question&gt;.  Again, whenever we call &#8216;make&#8217; in an action method, we&#8217;re setting something as the &#8216;.ast&#8217; attribute of the match object that gets returned, so this is just fetching whatever we &#8216;make&#8217; in the &#8216;question&#8217; method.</p>
<p>In the &#8216;question&#8217; method, we construct a new Question object, populating its attributes from the match object, and specifically set its &#8216;answers&#8217; attribute as the list of objects we produce in each call to the &#8216;answer&#8217; regex from the current parse of &#8216;question&#8217;.</p>
<p>In the &#8216;answer&#8217; method, we do the same thing, setting the &#8216;correct&#8217; attribute to the result of a comparison, so that it satisfies the &#8216;Bool&#8217; type constraint on the attribute.</p>
<p>So, again, to use this in a parse, we instantiate this new class and pass the object as the :action parameter to the &#8216;.parse&#8217; method of the grammar, and then we fetch the constructed object from the &#8216;.ast&#8217; attribute of the match object it returns:</p>
<pre>my $actions = Question::Actions.new();
my @questions = Question::Grammar.parse($text, :actions($actions)).ast.flat;
We need .flat for the same reason as before.</pre>
<p>Now we can inspect the created objects to see that everything went according to plan:</p>
<pre>for @questions -&gt; $q {
    say $q.text;
    for $q.answers.kv -&gt; $i, $a {
        say "    $i) {$a.text}";
    }
}</pre>
<p>To finish this post off, let&#8217;s add a method to Question to ask the question, fetch an answer, and grade the question.</p>
<p>Let&#8217;s start by printing out a representation of the question, its answers, and a prompt:</p>
<pre>    method ask {
        my %hints = (
            pickmany =&gt; "Choose all that are true",
            pickone =&gt; "Choose the one item that is correct",
        );
        say "\n{%hints{$.type}}\n";
        say $.text;
        for @.answers.kv -&gt; $i, $a {
            say "$i) {$a.text}";
        }
        print "&gt; ";</pre>
<p>Next, let&#8217;s fetch a line from STDIN and pull out the digits.</p>
<pre>        my $line = $*IN.get();
        my @answers = $line.comb(/&lt;digit&gt;+/)&gt;&gt;.Int.sort;</pre>
<p>&#8216;comb&#8217; is kind of the opposite of &#8216;split&#8217;, in that we specify what we want to keep instead of what we want to discard.  The advantage here is that we don&#8217;t have to choose a delimiter.  The user can enter &#8220;1 2 3&#8243;, &#8220;1,2,3&#8243;, or even &#8220;1, 2, and 3&#8243;.  We then use a hyperoperator method call to generate an array of Integers from the array of Matches, and then sort it.</p>
<p>Next, let&#8217;s generate a corresponding array of all of the correct answer indexes, and then compare them to determine correctness of the response.  This isn&#8217;t the only way to do it, merely the first that occurred to me. :)</p>
<pre>        my @correct = @.answers.kv.map({ $^value.correct ?? $^key !! () });
        if @correct ~~ @answers {
            say "Yay, you got it right!";
            return 1;
        }
        else {
            say "Oops... you got it wrong. :(";
            return 0;
        }
    }</pre>
<p>Let&#8217;s call it on each question and collect the results by mapping over our new method:</p>
<pre>my @results = @questions.map(*.ask);
say "\nFinal score: " ~ [+] @results;</pre>
<p>You&#8217;ll get results like this:</p>
<pre>[sweeks@kupo ~]$ perl6 /tmp/questions.pl 

Choose all that are true, separated by spaces

Which items are food?
0) Rice
1) Orange
2) Mushroom
3) Shoes
&gt; 0 1 2
Yay, you got it right!

Choose the one item that is correct

Which item is a color?
0) Orange
1) Shoes
2) Mushroom
3) Rice
&gt; 1
Oops... you got it wrong. :(

Final score: 1</pre>
<p>With everything put together, here&#8217;s the full program we&#8217;ve written:</p>
<pre>
<pre>﻿﻿﻿﻿﻿
class Question::Answer {
    has $.text is rw;
    has Bool $.correct is rw;
}
class Question {
    has $.text is rw;
    has $.type is rw;
    has Question::Answer @.answers is rw;
    method ask {
        my %hints = (
            pickmany =&gt; "Choose all that are true",
            pickone =&gt; "Choose the one item that is correct",
        );
        say "\n{%hints{$.type}}\n";
        say $.text;
        for @.answers.kv -&gt; $i, $a {
            say "$i) {$a.text}";
        }
        print "&gt; ";
        my $line = $*IN.get();
        my @answers = $line.comb(/&lt;digit&gt;+/)&gt;&gt;.Int.sort;
        my @correct = @.answers.kv.map({ $^value.correct ?? $^key !! () });
        if @correct ~~ @answers {
            say "Yay, you got it right!";
            return 1;
        } else {
            say "Oops... you got it wrong. :(";
            return 0;
        }
    }
}

<div id="_mcePaste"><span style="font-family:'Lucida Grande', Verdana, Arial, sans-serif;line-height:16px;white-space:normal;color:#333333;">
<pre>grammar Question::Grammar {
    token TOP {
        \n*
        &lt;question&gt;+
    }
    token question {
        &lt;header&gt;
        &lt;answer&gt;+
    }
    token header {
        ^^ $&lt;type&gt;=['pickone'|'pickmany'] ':' \s+ $&lt;text&gt;=[\N*] \n
    }
    token answer {
        ^^ \s+ $&lt;correct&gt;=['ac'|'ai'] ':' \s+ $&lt;text&gt;=[\N*] \n
    }
}

class Question::Actions {
    method TOP($/) {
        make $&lt;question&gt;».ast;
    }
    method question($/) {
        make Question.new(
            text =&gt; ~$&lt;header&gt;&lt;text&gt;,
            type =&gt; ~$&lt;header&gt;&lt;type&gt;,
            answers =&gt; $&lt;answer&gt;».ast,
        );
    }
    method answer($/) {
        make Question::Answer.new(
            correct =&gt; ~$&lt;correct&gt; eq 'ac',
            text =&gt; ~$&lt;text&gt;,
        );
    }
}

my $text = Q {
pickmany: Which items are food?
    ac: Rice
    ac: Orange
    ac: Mushroom
    ai: Shoes
pickone: Which item is a color?
    ac: Orange
    ai: Shoes
    ai: Mushroom
    ai: Rice
};

my $actions = Question::Actions.new();
my @questions = Question::Grammar.parse($text, :actions($actions)).ast.flat;
my @results = @questions.map(*.ask);

say "\nFinal score: " ~ [+] @results;</pre>
<p></span></div>

<div class="wpa" style="position: relative; width:300px; text-align: center; padding: 0; margin: 10px auto; overflow: hidden; clear: both;">
<a style="position: absolute; text-align: left; display: block; font: 9px/1 sans-serif; text-decoration: underline;" href="http://en.wordpress.com/about-these-ads/" rel="nofollow">About these ads</a>
<script type="text/javascript">
		var wpcom_adclk_hovering = false;
		var wpcom_adclk_recorded = false;
		var wpcom_adclk_theme = "Kubrick";
		var wpcom_adclk_slot = "wpcom_below_post";
		var wpcom_adclk_network = ( typeof wpcom_adclk_network === "undefined" ) ? "" : wpcom_adclk_network ;

		jQuery(document).ready( function() {
			function wpcom_adclk_hover_yes() { wpcom_adclk_hovering = true; }
			function wpcom_adclk_hover_no() { wpcom_adclk_hovering = false; }
			jQuery(".wpa").click(wpcom_adclk_click);
			jQuery(".wpa iframe").hover( wpcom_adclk_hover_yes, wpcom_adclk_hover_no );
			jQuery(".wpa object").hover( wpcom_adclk_hover_yes, wpcom_adclk_hover_no );

			jQuery(window).blur( function() {
				if ( wpcom_adclk_hovering ) { wpcom_adclk_click(); }
			});
		});

		function wpcom_adclk_impression() {
			var stat_gif = document.location.protocol + "//stats.wordpress.com/g.gif?v=wpcom-no-pv";
			stat_gif += "&x_ads_imp_theme=" + wpcom_adclk_theme;
			stat_gif += "&x_ads_imp_placement="+wpcom_adclk_slot;
			stat_gif += "&x_ads_imp_network=" + wpcom_adclk_network;
			stat_gif += "&x_ads_imp_theme_network="+wpcom_adclk_theme+"_"+wpcom_adclk_network;
			new Image().src = stat_gif + "&baba=" + Math.random();
			return true;
		}

		function wpcom_adclk_click() {
			if (wpcom_adclk_recorded) { return true; } // no double counting
			var stat_gif = document.location.protocol + "//stats.wordpress.com/g.gif?v=wpcom-no-pv";
			stat_gif += "&x_ads_click_theme=" + wpcom_adclk_theme;
			stat_gif += "&x_ads_click_placement="+wpcom_adclk_slot;
			stat_gif += "&x_ads_click_network=" + wpcom_adclk_network;
			stat_gif += "&x_ads_click_theme_network="+wpcom_adclk_theme+"_"+wpcom_adclk_network;

			new Image().src = stat_gif + "&baba=" + Math.random();
			wpcom_adclk_recorded = true;
			var now=new Date(); var end=now.getTime()+250;
			while(true){now=new Date();if(now.getTime()>end){break;}}
			return true;
		}
	
if ( typeof GA_googleAddAttr == 'function' ) {
GA_googleAddAttr("AdOpt", "1");
GA_googleAddAttr("Origin", "other");
GA_googleAddAttr("LangId", "1");
GA_googleAddAttr("Domain", "perl6advent.wordpress.com");
GA_googleAddAttr("BlogId", "10740073");
GA_googleAddAttr("PageURL", "https://perl6advent.wordpress.com/2009/12/21/day-21-grammars-and-actions/");
GA_googleAddAttr("Autotag", "technology");
GA_googleAddAttr("Autotag", "science");
GA_googleAddAttr("Tag", "2009");
GA_googleAddAttr("theme_bg", "ffffff");
GA_googleAddAttr("theme_text", "333333");
GA_googleAddAttr("theme_link", "0066cc");
GA_googleAddAttr("theme_border", "f9f9f9");
GA_googleAddAttr("theme_url", "114477");
GA_googleAddAdSensePageAttr("google_page_url", "https://perl6advent.wordpress.com/2009/12/21/day-21-grammars-and-actions/");
GA_googleFillSlot("wpcom_below_post");
}
</script>
</div>
<style type="text/css">
div.wpa>div { margin-top: 1em; } #google_ads_div_wpcom_below_post_adsafe_ad_container { display: block !important; }
</style>
<script type="text/javascript">
jQuery( window ).load( function() {
    if ( jQuery(".wpa script[src*='virool.com']").length > 0 || jQuery(".wpa script[src*='shareth.ru']").length > 0 || jQuery(".wpa iframe[src*='boomvideo.tv']").length > 0 || jQuery(".wpa iframe[src*='viewablemedia.net']").length > 0 || jQuery(".wpa .sharethrough-placement").length > 0 ) {
        jQuery( '.wpa' ).css( 'width', '400px' );
    }
setTimeout(function(){if(typeof GS_googleAddAdSenseService !== 'function'){new Image().src=document.location.protocol+"//stats.wordpress.com/g.gif?v=wpcom-no-pv&x_noads=adblock&baba="+Math.random()}},100);
} );
</script>
<div id="jp-post-flair" class="sharedaddy sd-like-enabled"><div class='sharedaddy sd-block sd-like jetpack-likes-widget-wrapper jetpack-likes-widget-unloaded' id='like-post-wrapper-10740073-323-534cd1bd0ac29' data-src='//widgets.wp.com/likes/#blog_id=10740073&amp;post_id=323&amp;origin=perl6advent.wordpress.com&amp;obj_id=10740073-323-534cd1bd0ac29' data-name='like-post-frame-10740073-323-534cd1bd0ac29'><h3 class='sd-title'>Like this:</h3><div class='likes-widget-placeholder post-likes-widget-placeholder' style='height:55px'><span class='button'><span>Like</span></span> <span class="loading">Loading...</span></div><span class='sd-text-color'></span><a class='sd-link-color'></a></div>
<div id='jp-relatedposts' class='jp-relatedposts' >
	<h3 class="jp-relatedposts-headline"><em>Related</em></h3>
</div></div>
								
				<p class="postmetadata alt">
					<small>
												This entry was posted on December 21, 2009 at 12:01 am and is filed under <a href="https://perl6advent.wordpress.com/category/2009/" title="View all posts in 2009" rel="category tag">2009</a>.						You can follow any responses to this entry through the <a href='https://perl6advent.wordpress.com/2009/12/21/day-21-grammars-and-actions/feed/'>RSS 2.0</a> feed.
													You can <a href="#respond">leave a response</a>, or <a href="https://perl6advent.wordpress.com/2009/12/21/day-21-grammars-and-actions/trackback/" rel="trackback">trackback</a> from your own site.
						
					</small>
				</p>

			</div>
		</div>

	
<!-- You can start editing here. -->
	<h3 id="comments">7 Responses to &#8220;Day 21, Grammars and&nbsp;Actions&#8221;</h3>

	<ol class="commentlist">
					<li class="comment even thread-even depth-1 highlander-comment" id="comment-183">
			<img alt='' src='https://0.gravatar.com/avatar/ca9dfcde6cee5ca62b85e815ae0522e0?s=32&#038;d=identicon&#038;r=G' class='avatar avatar-32' height='32' width='32' />			<cite><a href='http://www.illvilja.se' rel='external nofollow' class='url'>illviljan</a></cite> Says:						<br />

			<small class="commentmetadata"><a href="#comment-183" title="">December 21, 2009 at 10:37 am</a> | <a class='comment-reply-link' href='/2009/12/21/day-21-grammars-and-actions/?replytocom=183#respond' onclick='return addComment.moveForm("comment-183", "183", "respond", "323")'>Reply</a> </small>

			<p>Really interesting stuff and I understand that it is difficult to really subdivide it into smaller fragments.  Still, this is the first Perl6 Advent Calendar gift I felt that I have to digest under the course of several days.</p>
<p>There is quite a lot of stuff to grasp here (but no wonder, the Regexes part is one of the pieces that got a major overhaul in Perl6 compared to perl5).</p>
<p>Keep up the good work!</p>
</li><!-- #comment-## -->
			<li class="comment byuser comment-author-mberends odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-186">
			<img alt='' src='https://0.gravatar.com/avatar/69502e51989861970181ee55a50a5feb?s=32&#038;d=identicon&#038;r=G' class='avatar avatar-32' height='32' width='32' />			<cite>mberends</cite> Says:						<br />

			<small class="commentmetadata"><a href="#comment-186" title="">December 21, 2009 at 7:31 pm</a> | <a class='comment-reply-link' href='/2009/12/21/day-21-grammars-and-actions/?replytocom=186#respond' onclick='return addComment.moveForm("comment-186", "186", "respond", "323")'>Reply</a> </small>

			<p>Tene++ for a producing a very nice example and post.  The explanation is very clear and beautifully worded too, imho.  Well done!</p>
</li><!-- #comment-## -->
			<li class="comment even thread-even depth-1 highlander-comment" id="comment-193">
			<img alt='' src='https://0.gravatar.com/avatar/34641def1eb82e2a45951f890a8067af?s=32&#038;d=identicon&#038;r=G' class='avatar avatar-32' height='32' width='32' />			<cite><a href='http://runningadrenaline.tk' rel='external nofollow' class='url'>Amber Spencer</a></cite> Says:						<br />

			<small class="commentmetadata"><a href="#comment-193" title="">December 22, 2009 at 10:37 am</a> | <a class='comment-reply-link' href='/2009/12/21/day-21-grammars-and-actions/?replytocom=193#respond' onclick='return addComment.moveForm("comment-193", "193", "respond", "323")'>Reply</a> </small>

			<p>Thanks for the nice explanation, helped me a lot:D</p>
</li><!-- #comment-## -->
			<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-204">
			<img alt='' src='https://2.gravatar.com/avatar/e7ae6cbe101e61507a2b64eb86c83100?s=32&#038;d=identicon&#038;r=G' class='avatar avatar-32' height='32' width='32' />			<cite>Daniel Brockman</cite> Says:						<br />

			<small class="commentmetadata"><a href="#comment-204" title="">December 23, 2009 at 2:29 am</a> | <a class='comment-reply-link' href='/2009/12/21/day-21-grammars-and-actions/?replytocom=204#respond' onclick='return addComment.moveForm("comment-204", "204", "respond", "323")'>Reply</a> </small>

			<p>I think this is my favorite gift so far. It&#8217;s a bit long, but the writing is really good so the length isn&#8217;t really a problem. The examples are beautiful and manage to tie together a lot of different parts of the language quite nicely. Bravo!</p>
</li><!-- #comment-## -->
			<li class="comment even thread-even depth-1 highlander-comment" id="comment-894">
			<img alt='' src='https://1.gravatar.com/avatar/dd1eb60f4d1288ee3cb0377fe6d280fc?s=32&#038;d=identicon&#038;r=G' class='avatar avatar-32' height='32' width='32' />			<cite>Reader</cite> Says:						<br />

			<small class="commentmetadata"><a href="#comment-894" title="">June 17, 2011 at 3:53 am</a> | <a class='comment-reply-link' href='/2009/12/21/day-21-grammars-and-actions/?replytocom=894#respond' onclick='return addComment.moveForm("comment-894", "894", "respond", "323")'>Reply</a> </small>

			<p>:action has been renamed to :actions in the Grammar.parse method</p>
</li><!-- #comment-## -->
			<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-895">
			<img alt='' src='https://2.gravatar.com/avatar/539dfdbc3dde7e0e98d85772ba350737?s=32&#038;d=identicon&#038;r=G' class='avatar avatar-32' height='32' width='32' />			<cite>Reader</cite> Says:						<br />

			<small class="commentmetadata"><a href="#comment-895" title="">June 17, 2011 at 6:09 am</a> | <a class='comment-reply-link' href='/2009/12/21/day-21-grammars-and-actions/?replytocom=895#respond' onclick='return addComment.moveForm("comment-895", "895", "respond", "323")'>Reply</a> </small>

			<p>Using rakudo-star-2011.04:</p>
<p>  :action has been renamed to :actions in the Grammar.parse method</p>
</li><!-- #comment-## -->
			<li class="comment even thread-even depth-1 highlander-comment" id="comment-2633">
			<img alt='' src='https://2.gravatar.com/avatar/5814e7cc364ddfef8e8af286431d8e53?s=32&#038;d=identicon&#038;r=G' class='avatar avatar-32' height='32' width='32' />			<cite><a href='http://et-jeans.info/about/' rel='external nofollow' class='url'>Chase</a></cite> Says:						<br />

			<small class="commentmetadata"><a href="#comment-2633" title="">January 2, 2013 at 6:34 am</a> | <a class='comment-reply-link' href='/2009/12/21/day-21-grammars-and-actions/?replytocom=2633#respond' onclick='return addComment.moveForm("comment-2633", "2633", "respond", "323")'>Reply</a> </small>

			<p>Hello, Neat post. There is an issue together with your website in<br />
web explorer, may test this? IE nonetheless is the market leader and a big component of other people will omit your magnificent writing due to this problem.</p>
</li><!-- #comment-## -->
	</ol>

	<div class="navigation">
		<div class="alignleft"></div>
		<div class="alignright"></div>
	</div>



								<div id="respond" class="comment-respond">
				<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/2009/12/21/day-21-grammars-and-actions/#respond" style="display:none;">Cancel reply</a></small></h3>
									<form action="https://perl6advent.wordpress.com/wp-comments-post.php" method="post" id="commentform" class="comment-form">
																										


												<input type="hidden" id="highlander_comment_nonce" name="highlander_comment_nonce" value="69292a17f8" /><input type="hidden" name="_wp_http_referer" value="/2009/12/21/day-21-grammars-and-actions/" />
<input type="hidden" name="hc_post_as" id="hc_post_as" value="guest" />

<div class="comment-form-field comment-textarea">
	<label for="comment">Enter your comment here...</label>
	<div id="comment-form-comment"><textarea id="comment" name="comment" title="Enter your comment here..."></textarea></div>
</div>

<div id="comment-form-identity">

	<div id="comment-form-nascar">
		<p>Fill in your details below or click an icon to log in:</p>
		<ul>
			<li class="selected" style="display:none;">
				<a href="#comment-form-guest" id="postas-guest" title="Guest">
					<span></span>
				</a>
			</li>
			<li>
				<a href="#comment-form-load-service:WordPress.com" id="postas-wordpress" title="WordPress.com">
					<span></span>
				</a>
			</li>
			<li>
				<a href="#comment-form-load-service:Twitter" id="postas-twitter" title="Twitter">
					<span></span>
				</a>
			</li>
			<li>
				<a href="#comment-form-load-service:Facebook" id="postas-facebook" title="Facebook">
					<span></span>
				</a>
			</li>
			<li>
			<iframe id="googleplus-sign-in" name="googleplus-sign-in" src="https://public-api.wordpress.com/connect/?googleplus-sign-in=https%3A%2F%2Fperl6advent.wordpress.com" width="24" height="24" scrolling="no" allowtransparency="true" seamless="seamless" frameborder="0"></iframe>
			</li>
		</ul>
	</div>

	<div id="comment-form-guest" class="comment-form-service selected">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
<a href="https://gravatar.com/site/signup/" target="_blank">				<img src="https://1.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=25&amp;d=identicon&amp;forcedefault=y&amp;r=G" alt="Gravatar" width="25" class="no-grav" />
</a>			</div>

				<div class="comment-form-fields">
				<div class="comment-form-field comment-form-email">
					<label for="email">Email <span class="required">(required)</span> <span class="nopublish">(Address never made public)</span></label>
					<div class="comment-form-input"><input id="email" name="email" type="email" value="" /></div>
				</div>
				<div class="comment-form-field comment-form-author">
					<label for="author">Name <span class="required">(required)</span></label>
					<div class="comment-form-input"><input id="author" name="author" type="text" value="" /></div>
				</div>
				<div class="comment-form-field comment-form-url">
					<label for="url">Website</label>
					<div class="comment-form-input"><input id="url" name="url" type="text" value="" /></div>
				</div>
			</div>
	
		</div>
	</div>

	<div id="comment-form-wordpress" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="https://s2.wp.com/wp-content/mu-plugins/highlander-comments/images/wplogo.png" alt="WordPress.com Logo" width="25" class="no-grav" />
			</div>

				<div class="comment-form-fields">
				<input type="hidden" name="wp_avatar" id="wordpress-avatar" class="comment-meta-wordpress" value="" />
				<input type="hidden" name="wp_user_id" id="wordpress-user_id" class="comment-meta-wordpress" value="" />
				<input type="hidden" name="wp_access_token" id="wordpress-access_token" class="comment-meta-wordpress" value="" />
				<p class="comment-form-posting-as pa-wordpress"><strong></strong> You are commenting using your WordPress.com account. <span class="comment-form-log-out">(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout( 'wordpress' );">Log&nbsp;Out</a>&nbsp;/&nbsp;<a href="#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)</span></p>
			</div>
	
		</div>
	</div>

	<div id="comment-form-twitter" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="https://1.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=25&amp;d=identicon&amp;forcedefault=y&amp;r=G" alt="Twitter picture" width="25" class="no-grav" />
			</div>

				<div class="comment-form-fields">
				<input type="hidden" name="twitter_avatar" id="twitter-avatar" class="comment-meta-twitter" value="" />
				<input type="hidden" name="twitter_user_id" id="twitter-user_id" class="comment-meta-twitter" value="" />
				<input type="hidden" name="twitter_access_token" id="twitter-access_token" class="comment-meta-twitter" value="" />
				<p class="comment-form-posting-as pa-twitter"><strong></strong> You are commenting using your Twitter account. <span class="comment-form-log-out">(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout( 'twitter' );">Log&nbsp;Out</a>&nbsp;/&nbsp;<a href="#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)</span></p>
			</div>
	
		</div>
	</div>

	<div id="comment-form-facebook" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="https://1.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=25&amp;d=identicon&amp;forcedefault=y&amp;r=G" alt="Facebook photo" width="25" class="no-grav" />
			</div>

				<div class="comment-form-fields">
				<input type="hidden" name="fb_avatar" id="facebook-avatar" class="comment-meta-facebook" value="" />
				<input type="hidden" name="fb_user_id" id="facebook-user_id" class="comment-meta-facebook" value="" />
				<input type="hidden" name="fb_access_token" id="facebook-access_token" class="comment-meta-facebook" value="" />
				<p class="comment-form-posting-as pa-facebook"><strong></strong> You are commenting using your Facebook account. <span class="comment-form-log-out">(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout( 'facebook' );">Log&nbsp;Out</a>&nbsp;/&nbsp;<a href="#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)</span></p>
			</div>
	
		</div>
	</div>

	<div id="comment-form-googleplus" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="https://1.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=25&amp;d=identicon&amp;forcedefault=y&amp;r=G" alt="Google+ photo" width="25" class="no-grav" />
			</div>

				<div class="comment-form-fields">
				<input type="hidden" name="googleplus_avatar" id="googleplus-avatar" class="comment-meta-googleplus" value="" />
				<input type="hidden" name="googleplus_user_id" id="googleplus-user_id" class="comment-meta-googleplus" value="" />
				<input type="hidden" name="googleplus_access_token" id="googleplus-access_token" class="comment-meta-googleplus" value="" />
				<p class="comment-form-posting-as pa-googleplus"><strong></strong> You are commenting using your Google+ account. <span class="comment-form-log-out">(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout( 'googleplus' );">Log&nbsp;Out</a>&nbsp;/&nbsp;<a href="#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)</span></p>
			</div>
	
		</div>
	</div>


	<div id="comment-form-load-service" class="comment-form-service">
		<div class="comment-form-posting-as-cancel"><a href="javascript:HighlanderComments.cancelExternalWindow();">Cancel</a></div>
		<p>Connecting to %s</p>
	</div>

	
</div>

<script type="text/javascript">
var highlander_expando_javascript = function(){
	var input = document.createElement( 'input' ),
	    comment = jQuery( '#comment' );

	if ( 'placeholder' in input ) {
		comment.attr( 'placeholder', jQuery( '.comment-textarea label' ).remove().text() );
	}

	// Expando Mode: start small, then auto-resize on first click + text length
	jQuery( '#comment-form-identity' ).hide();
	jQuery( '#comment-form-subscribe' ).hide();
	jQuery( '#commentform .form-submit' ).hide();

	comment.css( { 'height':'10px' } ).one( 'focus', function() {
		var timer = setInterval( HighlanderComments.resizeCallback, 10 )
		jQuery( this ).animate( { 'height': HighlanderComments.initialHeight } ).delay( 100 ).queue( function(n) { clearInterval( timer ); HighlanderComments.resizeCallback(); n(); } );
		jQuery( '#comment-form-identity' ).slideDown();
		jQuery( '#comment-form-subscribe' ).slideDown();
		jQuery( '#commentform .form-submit' ).slideDown();
	});
}
jQuery(document).ready( highlander_expando_javascript );
</script>

<div id="comment-form-subscribe">
	<p class="comment-subscription-form"><input type="checkbox" name="subscribe" id="subscribe" value="subscribe" style="width: auto;" tabindex="6"/> <label class="subscribe-label" id="subscribe-label" for="subscribe" style="display: inline;">Notify me of follow-up comments via email.</label></p></div>

												<p class="form-submit">
							<input name="submit" type="submit" id="comment-submit" value="Post Comment" />
							<input type='hidden' name='comment_post_ID' value='323' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
						</p>
						
<input type="hidden" name="genseq" value="1397543357" />
<p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="56a8394c7f" /></p><script type='text/javascript' src='https://s2.wp.com/wp-content/mu-plugins/akismet-2.5/form.js?m=1308783962g'></script>
<p style="display: none;"><input type="hidden" id="ak_js" name="ak_js" value="246"/></p>					</form>
							</div><!-- #respond -->
			<div style="clear: both"></div>

	
	</div>


<hr />
<div id="footer">
	<p>
		<a href="http://theme.wordpress.com/themes/kubrick/" title="Learn more about this theme">The Kubrick Theme</a> <a href="http://wordpress.com/?ref=footer">Blog at WordPress.com</a>.
		<br /><a href="https://perl6advent.wordpress.com/feed/">Entries (RSS)</a> and <a href="https://perl6advent.wordpress.com/comments/feed/">Comments (RSS)</a>.	</p>
</div>
</div>

<script type='text/javascript' src='//0.gravatar.com/js/gprofiles.js?ver=201416x'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type='text/javascript' src='https://s2.wp.com/wp-content/mu-plugins/gravatar-hovercards/wpgroho.js?m=1380573781g'></script>

	<script>
		//initialize and attach hovercards to all gravatars
		jQuery( document ).ready( function( $ ) {
			Gravatar.profile_cb = function( hash, id ) {
				WPGroHo.syncProfileData( hash, id );
			};
			Gravatar.my_hash = WPGroHo.my_hash;
			Gravatar.init( 'body', '#wp-admin-bar-my-account' );
		});
	</script>

		<div style="display:none">
	<div class="grofile-hash-map-ca9dfcde6cee5ca62b85e815ae0522e0">
	</div>
	<div class="grofile-hash-map-69502e51989861970181ee55a50a5feb">
	</div>
	<div class="grofile-hash-map-34641def1eb82e2a45951f890a8067af">
	</div>
	<div class="grofile-hash-map-e7ae6cbe101e61507a2b64eb86c83100">
	</div>
	<div class="grofile-hash-map-dd1eb60f4d1288ee3cb0377fe6d280fc">
	</div>
	<div class="grofile-hash-map-539dfdbc3dde7e0e98d85772ba350737">
	</div>
	<div class="grofile-hash-map-5814e7cc364ddfef8e8af286431d8e53">
	</div>
	</div>
<script type='text/javascript'>
/* <![CDATA[ */
var HighlanderComments = {"loggingInText":"Logging In\u2026","submittingText":"Posting Comment\u2026","postCommentText":"Post Comment","connectingToText":"Connecting to %s","commentingAsText":"%1$s: You are commenting using your %2$s account.","logoutText":"Log Out","loginText":"Log In","connectURL":"https:\/\/perl6advent.wordpress.com\/public.api\/connect\/?action=request","logoutURL":"https:\/\/perl6advent.wordpress.com\/wp-login.php?action=logout&_wpnonce=f3284f6283","homeURL":"https:\/\/perl6advent.wordpress.com\/","postID":"323","gravDefault":"identicon","enterACommentError":"Please enter a comment","enterEmailError":"Please enter your email address here","invalidEmailError":"Invalid email address","enterAuthorError":"Please enter your name here","gravatarFromEmail":"This picture will show whenever you leave a comment. Click to customize it.","logInToExternalAccount":"Log in to use details from one of these accounts.","change":"Change","changeAccount":"Change Account","comment_registration":"","userIsLoggedIn":"","isJetpack":"0"};
/* ]]> */
</script>
<script type='text/javascript' src='https://s0.wp.com/_static/??/wp-content/js/jquery/jquery.autoresize.js,/wp-content/mu-plugins/highlander-comments/script.js?m=1395185286j'></script>

	<div id="bit" class="loggedout-follow-normal">
		<a class="bsub" href="javascript:void(0)"><span id='bsub-text'>Follow</span></a>
		<div id="bitsubscribe">

					<h3><label for="loggedout-follow-field">Follow &ldquo;Perl 6 Advent Calendar&rdquo;</label></h3>

			<form action="https://subscribe.wordpress.com" method="post" accept-charset="utf-8" id="loggedout-follow">
			<p>Get every new post delivered to your Inbox.</p>

			<p id="loggedout-follow-error" style="display: none;"></p>

						<p class="bit-follow-count">Join 36 other followers</p>
			<p><input type="email" name="email" value="Enter your email address" onfocus='this.value=(this.value=="Enter your email address") ? "" : this.value;' onblur='this.value=(this.value=="") ? "Enter email address" : this.value;'  id="loggedout-follow-field"/></p>

			<input type="hidden" name="action" value="subscribe"/>
			<input type="hidden" name="blog_id" value="10740073"/>
			<input type="hidden" name="source" value="https://perl6advent.wordpress.com/2009/12/21/day-21-grammars-and-actions/"/>
			<input type="hidden" name="sub-type" value="loggedout-follow"/>

			<input type="hidden" id="_wpnonce" name="_wpnonce" value="012dea5bde" /><input type="hidden" name="_wp_http_referer" value="/2009/12/21/day-21-grammars-and-actions/" />
			<p id='bsub-subscribe-button'><input type="submit" value="Sign me up" /></p>
			</form>
					<div id='bsub-credit'><a href="http://wordpress.com/signup/?ref=lof">Powered by WordPress.com</a></div>
		</div><!-- #bitsubscribe -->
	</div><!-- #bit -->
	<script type="text/javascript">
	var skimlinks_pub_id = "725X584219"
	var skimlinks_sitename = "perl6advent.wordpress.com";
	</script>
	<script type="text/javascript" src="https://s.skimresources.com/js/725X1342.skimlinks.js"></script>		<iframe src='https://widgets.wp.com/likes/master.html?ver=20140227#ver=20140227&amp;mp6=1' scrolling='no' id='likes-master' name='likes-master' style='display:none;'></iframe>
		<div id='likes-other-gravatars'><div class="likes-text"><span>%d</span> bloggers like this:</div><ul class="wpl-avatars sd-like-gravatars"></ul></div>
		<script type="text/javascript">
		//<![CDATA[
			var jetpackLikesWidgetQueue = [];
			var jetpackLikesWidgetBatch = [];
			var jetpackLikesMasterReady = false;

			function JetpackLikespostMessage( message, target ) {
				if ( "string" === typeof message ){
					try{
						message = JSON.parse( message );
					}
					catch(e) {
						return;
					}
				}

				pm( {
					target: target,
					type: 'likesMessage',
					data: message,
					origin: '*'
				} );
			}

			function JetpackLikesBatchHandler() {
				var requests = [];
				jQuery( 'div.jetpack-likes-widget-unloaded' ).each( function( i ) {
					if ( jetpackLikesWidgetBatch.indexOf( this.id ) > -1 )
						return;
					jetpackLikesWidgetBatch.push( this.id );
					var regex = /like-(post|comment)-wrapper-(\d+)-(\d+)-(\w+)/;
					var match = regex.exec( this.id );
					if ( ! match || match.length != 5 )
						return;

					var info = {
						blog_id: match[2],
						width:   this.width
					};

					if ( 'post' == match[1] ) {
						info.post_id = match[3];
					} else if ( 'comment' == match[1] ) {
						info.comment_id = match[3];
					}

					info.obj_id = match[4];

					requests.push( info );
				});

				if ( requests.length > 0 ) {
					JetpackLikespostMessage( { event: 'initialBatch', requests: requests }, window.frames['likes-master'] );
				}
			}

			function JetpackLikesMessageListener( event ) {
				if ( "undefined" == typeof event.event )
					return;

				if ( 'masterReady' == event.event ) {
					jQuery( document ).ready( function() {
						jetpackLikesMasterReady = true;

						var stylesData = {
								event: 'injectStyles'
						};

						if ( jQuery( 'iframe.admin-bar-likes-widget' ).length > 0 ) {
							JetpackLikespostMessage( { event: 'adminBarEnabled' }, window.frames[ 'likes-master' ] );

							stylesData.adminBarStyles = {
								background: jQuery( '#wpadminbar .quicklinks li#wp-admin-bar-wpl-like > a' ).css( 'background' ),
								isRtl: ( 'rtl' == jQuery( '#wpadminbar' ).css( 'direction' ) )
							};
						}

						if ( !window.addEventListener )
							jQuery( '#wp-admin-bar-admin-bar-likes-widget' ).hide();

						stylesData.textStyles = {
							color: jQuery( '.sd-text-color').css( 'color' ),
							fontFamily: jQuery( '.sd-text-color' ).css( 'font-family' ),
							fontSize: jQuery( '.sd-text-color' ).css( 'font-size' ),
							direction: jQuery( '.sd-text-color' ).css( 'direction' ),
							fontWeight: jQuery( '.sd-text-color' ).css( 'font-weight' ),
							fontStyle: jQuery( '.sd-text-color' ).css( 'font-style' ),
							textDecoration: jQuery( '.sd-text-color' ).css('text-decoration')
						};

						stylesData.linkStyles = {
							color: jQuery( '.sd-link-color' ).css('color'),
							fontFamily: jQuery( '.sd-link-color' ).css('font-family'),
							fontSize: jQuery( '.sd-link-color' ).css('font-size'),
							textDecoration: jQuery( '.sd-link-color' ).css('text-decoration'),
							fontWeight: jQuery( '.sd-link-color' ).css( 'font-weight' ),
							fontStyle: jQuery( '.sd-link-color' ).css( 'font-style' )
						};

						JetpackLikespostMessage( stylesData, window.frames[ 'likes-master' ] );

						JetpackLikesBatchHandler();

						jQuery( document ).on( 'inview', 'div.jetpack-likes-widget-unloaded', function() {
							jetpackLikesWidgetQueue.push( this.id );
						});
					});
				}

				if ( 'showLikeWidget' == event.event ) {
					jQuery( '#' + event.id + ' .post-likes-widget-placeholder'  ).fadeOut( 'fast', function() {
						jQuery( '#' + event.id + ' .post-likes-widget' ).fadeIn( 'fast', function() {
							JetpackLikespostMessage( { event: 'likeWidgetDisplayed', blog_id: event.blog_id, post_id: event.post_id, obj_id: event.obj_id }, window.frames['likes-master'] );
						});
					});
				}

				if ( 'clickReblogFlair' == event.event ) {
					wpcom_reblog.toggle_reblog_box_flair( event.obj_id );
				}

				if ( 'showOtherGravatars' == event.event ) {
					var $container = jQuery( '#likes-other-gravatars' );
					var $list = $container.find( 'ul' );

					$container.hide();
					$list.html( '' );

					$container.find( '.likes-text span' ).text( event.total );

					jQuery.each( event.likers, function( i, liker ) {
						$list.append( '<li class="' + liker.css_class + '"><a href="' + liker.profile_URL + '" class="wpl-liker" rel="nofollow" target="_parent"><img src="' + liker.avatar_URL + '" alt="' + liker.name + '" width="30" height="30" style="padding-right: 3px;" /></a></li>');
					} );

					var offset = jQuery( "[name='" + event.parent + "']" ).offset();

					$container.css( 'left', offset.left + event.position.left - 10 + 'px' );
					$container.css( 'top', offset.top + event.position.top - 33 + 'px' );

					var rowLength = Math.floor( event.width / 37 );
					var height = ( Math.ceil( event.likers.length / rowLength ) * 37 ) + 13;
					if ( height > 204 ) {
						height = 204;
					}

					$container.css( 'height', height + 'px' );
					$container.css( 'width', rowLength * 37 - 7 + 'px' );

					$list.css( 'width', rowLength * 37 + 'px' );

					$container.fadeIn( 'slow' );

					var scrollbarWidth = $list[0].offsetWidth - $list[0].clientWidth;
					if ( scrollbarWidth > 0 ) {
						$container.width( $container.width() + scrollbarWidth );
						$list.width( $list.width() + scrollbarWidth );
					}
				}
			}

			pm.bind( 'likesMessage', function(e) { JetpackLikesMessageListener(e); } );

			jQuery( document ).click( function( e ) {
				var $container = jQuery( '#likes-other-gravatars' );

				if ( $container.has( e.target ).length === 0 ) {
					$container.fadeOut( 'slow' );
				}
			});

			function JetpackLikesWidgetQueueHandler() {
				var wrapperID;
				if ( ! jetpackLikesMasterReady ) {
					setTimeout( JetpackLikesWidgetQueueHandler, 500 );
					return;
				}

				if ( jetpackLikesWidgetQueue.length > 0 ) {
					// We may have a widget that needs creating now
					var found = false;
					while( jetpackLikesWidgetQueue.length > 0 ) {
						// Grab the first member of the queue that isn't already loading.
						wrapperID = jetpackLikesWidgetQueue.splice( 0, 1 )[0];
						if ( jQuery( '#' + wrapperID ).hasClass( 'jetpack-likes-widget-unloaded' ) ) {
							found = true;
							break;
						}
					}
					if ( ! found ) {
						setTimeout( JetpackLikesWidgetQueueHandler, 500 );
						return;
					}
				} else if ( jQuery( 'div.jetpack-likes-widget-unloaded' ).length > 0 ) {
					// Grab any unloaded widgets for a batch request
					JetpackLikesBatchHandler();

					// Get the next unloaded widget
					wrapperID = jQuery( 'div.jetpack-likes-widget-unloaded' ).first()[0].id;
					if ( ! wrapperID ) {
						// Everything is currently loaded
						setTimeout( JetpackLikesWidgetQueueHandler, 500 );
						return;
					}
				}

				if ( 'undefined' === typeof wrapperID ) {
					setTimeout( JetpackLikesWidgetQueueHandler, 500 );
					return;
				}

				var $wrapper = jQuery( '#' + wrapperID );
				$wrapper.find( 'iframe' ).remove();

				if ( $wrapper.hasClass( 'slim-likes-widget' ) ) {
					$wrapper.find( '.post-likes-widget-placeholder' ).after( "<iframe class='post-likes-widget jetpack-likes-widget' name='" + $wrapper.data( 'name' ) + "' height='22px' width='68px' frameBorder='0' scrolling='no' src='" + $wrapper.data( 'src' ) + "'></iframe>" );
				} else {
					$wrapper.find( '.post-likes-widget-placeholder' ).after( "<iframe class='post-likes-widget jetpack-likes-widget' name='" + $wrapper.data( 'name' ) + "' height='55px' width='100%' frameBorder='0' src='" + $wrapper.data( 'src' ) + "'></iframe>" );
				}

				$wrapper.removeClass( 'jetpack-likes-widget-unloaded' ).addClass( 'jetpack-likes-widget-loading' );

				$wrapper.find( 'iframe' ).load( function( e ) {
					var $iframe = jQuery( e.target );
					$wrapper.removeClass( 'jetpack-likes-widget-loading' ).addClass( 'jetpack-likes-widget-loaded' );

					JetpackLikespostMessage( { event: 'loadLikeWidget', name: $iframe.attr( 'name' ), width: $iframe.width() }, window.frames[ 'likes-master' ] );

					if ( $wrapper.hasClass( 'slim-likes-widget' ) ) {
						$wrapper.find( 'iframe' ).Jetpack( 'resizeable' );
					}
				});
				setTimeout( JetpackLikesWidgetQueueHandler, 250 );
			}
			JetpackLikesWidgetQueueHandler();
		//]]>
		</script>
<script type='text/javascript' src='https://s0.wp.com/_static/??/wp-content/js/devicepx.js,/wp-includes/js/comment-reply.min.js?m=1389017300j'></script>
<script type="text/javascript">
// <![CDATA[
(function() {
try{
  if ( window.external &&'msIsSiteMode' in window.external) {
    if (window.external.msIsSiteMode()) {
      var jl = document.createElement('script');
      jl.type='text/javascript';
      jl.async=true;
      jl.src='/wp-content/plugins/ie-sitemode/custom-jumplist.php';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(jl, s);
    }
  }
}catch(e){}
})();
// ]]>
</script><script src="https://ssl-stats.wordpress.com/w.js?21" type="text/javascript"></script>
<script type="text/javascript">
st_go({'blog':'10740073','v':'wpcom','tz':'0','user_id':'0','post':'323','subd':'perl6advent'});
ex_go({'crypt':'UE5XaGUuOTlwaD85flAmcm1mcmZsaDhkV11YdWFnNncxc1tjZG9XVXhReTFqanhKV3x0UkQxQldDVUV4ZVR+cSt8Ny8tTm40WDY2NUd1SH5CMko/Rmx6TmhYLjZfZi50XTNLJUVtLmVoc21CZmM1Tmh3eFFkb1BZZXpUfGR6Nng9bHQsekpEYjVBSiU/d0xqX0tsTnE3bHpybGUwRmdGOGFWP0paTnhURzguPzBzbDZtajQ3fmNHeVhOc18xKyVQQV0vUFRJVmd6diZpRDZuaDNEP2ZzLjZMSVd5ZkQ3aS92Qz9lQ1JaY1JaU111WStNQT1MTH5SX2J8UHAsNlcybXVSLDdNP3I1ZTE1YmN1ZiVwQ2NtLS5wSX5ZUkZKM2ds'});
addLoadEvent(function(){linktracker_init('10740073',323);});
	</script>
<noscript><img src="https://stats.wordpress.com/b.gif?v=noscript" style="height:0px;width:0px;overflow:hidden" alt="" /></noscript>
<script>
if ( 'object' === typeof wpcom_mobile_user_agent_info ) {

	wpcom_mobile_user_agent_info.init();
	var mobileStatsQueryString = "";
	
	if( false !== wpcom_mobile_user_agent_info.matchedPlatformName )
		mobileStatsQueryString += "&x_" + 'mobile_platforms' + '=' + wpcom_mobile_user_agent_info.matchedPlatformName;
	
	if( false !== wpcom_mobile_user_agent_info.matchedUserAgentName )
		mobileStatsQueryString += "&x_" + 'mobile_devices' + '=' + wpcom_mobile_user_agent_info.matchedUserAgentName;
	
	if( wpcom_mobile_user_agent_info.isIPad() )
		mobileStatsQueryString += "&x_" + 'ipad_views' + '=' + 'views';

	if( "" != mobileStatsQueryString ) {
		new Image().src = document.location.protocol + '//stats.wordpress.com/g.gif?v=wpcom-no-pv' + mobileStatsQueryString + '&baba=' + Math.random();
	}
	
}
</script></body>
</html>
