<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">

<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Day 23: Lazy fruits from the gather of Eden | Perl 6 Advent Calendar</title>
<link rel="pingback" href="https://perl6advent.wordpress.com/xmlrpc.php" />
<meta name="google-site-verification" content="YPNxtMSK3Jj7JR2XCK-hDqmF9xDIeBEyvYm3aT1s71Y" />
<link rel="alternate" type="application/rss+xml" title="Perl 6 Advent Calendar &raquo; Feed" href="https://perl6advent.wordpress.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Perl 6 Advent Calendar &raquo; Comments Feed" href="https://perl6advent.wordpress.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Perl 6 Advent Calendar &raquo; Day 23: Lazy fruits from the gather of&nbsp;Eden Comments Feed" href="https://perl6advent.wordpress.com/2009/12/23/day-23-lazy-fruits-from-the-gather-of-eden/feed/" />
<script type="text/javascript">
/* <![CDATA[ */
function addLoadEvent(func){var oldonload=window.onload;if(typeof window.onload!='function'){window.onload=func;}else{window.onload=function(){oldonload();func();}}}
/* ]]> */
</script>
<link rel='stylesheet' id='all-css-0' href='https://s0.wp.com/_static/??-eJx9j90OgjAMRl/I2Yjiz4XxWcZWx6CjC+tCfHuHiZFIwl2/5px+KUxRGR4EB4GQVaTs/JCAfI8JOpSoTa8+aW9S2sECb4jdT2Dn0HIW9WQinmDy1qGspEXHiKQFrYqc5C9taYZHLPsQtcxEQOs1EoaCbWkhnr/WPLblr3WNtOVOgpgb6HMzetNDkhfhDD7C/XC8XarqdK3r7g1dsHQ6' type='text/css' media='all' />
<!--[if lte IE 8]>
<link rel='stylesheet' id='kubrick-ie-css'  href='https://s0.wp.com/wp-content/themes/pub/kubrick/ie.css?m=1273203575g&#038;ver=3.9-RC1' type='text/css' media='all' />
<![endif]-->
<link rel='stylesheet' id='all-css-2' href='https://s0.wp.com/_static/??-eJxljEsKgDAMBS9kjX9wIZ5F2xArbSOm4vWtrgru3sCbgftQmkPEEMFf6nAX2SBw4uqY0iTQkmOZsIBMiht6FNg6IMfr4n6HrHpbQxjlSxKzOXEx8gqzn+p2rPqh6ep2fwA3cTYI' type='text/css' media='all' />
<link rel='stylesheet' id='print-css-2' href='https://s0.wp.com/wp-content/mu-plugins/global-print/global-print.css?m=1387483371g' type='text/css' media='print' />
<script type='text/javascript'>
/* <![CDATA[ */
var LoggedOutFollow = {"invalid_email":"Your subscription did not succeed, please try again with a valid email address."};
/* ]]> */
</script>
<script type='text/javascript' src='https://s0.wp.com/_static/??-eJyFj0kOwjAMRS+ESVEX0AXiLG3jRg6ZiBMiOD2pBAgKUlee3ve3RQkwepfQJaFZWD+QQciMsVe1B+Qmv9W8EZUjN5oskWdQXzLG2zOsAmBJxT7h1pJ7wR+uwXOyyFwt/0y/rchdCcsqpjGFfjxDRKb7z9bBeAXBZEWORc0VSp8TTN4YX0QhqTAtNTa/FRFNfUbCfPeiqqqTPe7abt8cuqbt9ANnG4Rf'></script>
<link rel='stylesheet' id='all-css-0' href='https://s2.wp.com/wp-content/mu-plugins/highlander-comments/style.css?m=1377793621g' type='text/css' media='all' />
<!--[if lt IE 8]>
<link rel='stylesheet' id='highlander-comments-ie7-css'  href='https://s2.wp.com/wp-content/mu-plugins/highlander-comments/style-ie7.css?m=1351637563g&#038;ver=20110606' type='text/css' media='all' />
<![endif]-->
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://perl6advent.wordpress.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://perl6advent.wordpress.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Day 22: Operator&nbsp;Overloading' href='https://perl6advent.wordpress.com/2009/12/22/day-22-operator-overloading/' />
<link rel='next' title='Day 24: The Perl 6 standard&nbsp;grammar' href='https://perl6advent.wordpress.com/2009/12/24/day-24-the-perl-6-standard-grammar/' />
<meta name="generator" content="WordPress.com" />
<link rel='canonical' href='https://perl6advent.wordpress.com/2009/12/23/day-23-lazy-fruits-from-the-gather-of-eden/' />
<link rel='shortlink' href='http://wp.me/pJ3YZ-5L' />
<link rel="alternate" type="application/json+oembed" href="https://public-api.wordpress.com/oembed/1.0/?format=json&amp;url=https%3A%2F%2Fperl6advent.wordpress.com%2F2009%2F12%2F23%2Fday-23-lazy-fruits-from-the-gather-of-eden%2F&amp;for=wpcom-auto-discovery" /><link rel="alternate" type="application/xml+oembed" href="https://public-api.wordpress.com/oembed/1.0/?format=xml&amp;url=https%3A%2F%2Fperl6advent.wordpress.com%2F2009%2F12%2F23%2Fday-23-lazy-fruits-from-the-gather-of-eden%2F&amp;for=wpcom-auto-discovery" />
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="Day 23: Lazy fruits from the gather of Eden" />
<meta property="og:url" content="https://perl6advent.wordpress.com/2009/12/23/day-23-lazy-fruits-from-the-gather-of-eden/" />
<meta property="og:description" content="Today&#039;s gift is a construct not often seen in other languages. It&#039;s an iterator builder! And it&#039;s called gather. But first, let&#039;s try a bit of historical perspective. Many Perl people know their ma..." />
<meta property="article:published_time" content="2009-12-23T00:01:22+00:00" />
<meta property="article:modified_time" content="2010-12-07T15:52:26+00:00" />
<meta property="article:author" content="https://perl6advent.wordpress.com/author/brushingupmyknuth/" />
<meta property="og:site_name" content="Perl 6 Advent Calendar" />
<meta property="og:image" content="http://wordpress.com/i/blank.jpg?m=1383295312g" />
<meta name="twitter:site" content="@wordpressdotcom" />
<meta name="twitter:card" content="summary" />
<meta property="fb:app_id" content="249643311490" />
<meta property="article:publisher" content="https://www.facebook.com/WordPresscom" />
<link rel="shortcut icon" type="image/x-icon" href="https://s2.wp.com/i/favicon.ico" sizes="16x16 24x24 32x32 48x48" />
<link rel="icon" type="image/x-icon" href="https://s2.wp.com/i/favicon.ico" sizes="16x16 24x24 32x32 48x48" />
<link rel="apple-touch-icon-precomposed" href="https://s0.wp.com/i/webclip.png" />
<link rel='openid.server' href='https://perl6advent.wordpress.com/?openidserver=1' />
<link rel='openid.delegate' href='https://perl6advent.wordpress.com/' />
<link rel="search" type="application/opensearchdescription+xml" href="https://perl6advent.wordpress.com/osd.xml" title="Perl 6 Advent Calendar" />
<link rel="search" type="application/opensearchdescription+xml" href="http://wordpress.com/opensearch.xml" title="WordPress.com" />
<style type='text/css'><!--
body { background: url("https://s0.wp.com/wp-content/themes/pub/kubrick/images/kubrickbgcolor.gif"); }
#page { background: url("https://s0.wp.com/wp-content/themes/pub/kubrick/images/kubrickbgwide.gif") repeat-y top !important; border: none; }
#header { background: url("https://s0.wp.com/wp-content/themes/pub/kubrick/images/kubrickheader.gif") no-repeat bottom center; }
#footer { background: url("https://s0.wp.com/wp-content/themes/pub/kubrick/images/kubrickfooter.gif") no-repeat bottom; border: none;}
#header { margin: 0 !important; margin: 0 0 0 1px; padding: 1px; height: 198px; width: 758px; }
#headerimg { margin: 7px 9px 0; height: 192px; width: 740px; }
#headerimg h1 a, #headerimg h1 a:visited, #headerimg .description { color: #FFFFFF; }
#headerimg h1 a, #headerimg .description { display:  }

	--></style><meta name="application-name" content="Perl 6 Advent Calendar" /><meta name="msapplication-window" content="width=device-width;height=device-height" /><meta name="msapplication-tooltip" content="Something cool about Perl 6 every day" /><meta name="msapplication-task" content="name=Subscribe;action-uri=https://perl6advent.wordpress.com/feed/;icon-uri=https://s2.wp.com/i/favicon.ico" /><meta name="msapplication-task" content="name=Sign up for a free blog;action-uri=http://wordpress.com/signup/;icon-uri=https://s2.wp.com/i/favicon.ico" /><meta name="msapplication-task" content="name=WordPress.com Support;action-uri=http://support.wordpress.com/;icon-uri=https://s2.wp.com/i/favicon.ico" /><meta name="msapplication-task" content="name=WordPress.com Forums;action-uri=http://forums.wordpress.com/;icon-uri=https://s2.wp.com/i/favicon.ico" /><meta name="title" content="Day 23: Lazy fruits from the gather of&nbsp;Eden | Perl 6 Advent Calendar on WordPress.com" />
<meta name="description" content="Today&#039;s gift is a construct not often seen in other languages. It&#039;s an iterator builder! And it&#039;s called gather. But first, let&#039;s try a bit of historical perspective. Many Perl people know their map, grep and sort, convenient functions to carry out simple list transformations, filterings and rankings without having to resort to for loops.&hellip;" />
<style type="text/css">
#header     { margin: 0 !important; margin: 0 0 0 1px; padding: 1px; height: 198px; width: 758px; }
#headerimg  { margin: 7px 9px 0; height: 192px; width: 740px; }
#headerimg { background: url(https://perl6advent.files.wordpress.com/2009/12/perl6advent2.png) no-repeat top;}
#header h1 a, #header h1 a:hover, #header .description {
	color: #fff;
}
</style>

<script type='text/javascript' src='http://partner.googleadservices.com/gampad/google_service.js'>
</script>
<script type='text/javascript'>
if ( typeof GS_googleAddAdSenseService == 'function' ) { GS_googleAddAdSenseService("ca-pub-3443918307802676"); }
if ( typeof GS_googleEnableAllServices == 'function' ) { GS_googleEnableAllServices() };
</script>
<script type="text/javascript" src="http://c.amazon-adsystem.com/aax2/amzn_ads.js"></script>
<script type="text/javascript">
try { amznads.getAds("3033","300x250"); } catch(e) { /* ignore */ }
</script>
<script type="text/javascript">
var amznKeys = amznads.getKeys();
if (typeof amznKeys != "undefined" && amznKeys != "") { for (var i =0; i < amznKeys.length; i++) { var key = amznKeys[i]; GA_googleAddAttr("amzn", key);} }
document.close();
</script>
<script type='text/javascript'>
if ( typeof GA_googleAddSlot == 'function' ) { GA_googleAddSlot("ca-pub-3443918307802676", "wpcom_below_post"); }
</script>
<script type='text/javascript'>
if ( typeof GA_googleFetchAds == 'function' ) { GA_googleFetchAds(); }
</script>

<script type="text/javascript">
var wpcom_ads = { bid: 10740073, pt: 'permalink', wa: 0, as: 0, domain: 'perl6advent.wordpress.com', url: 'https://perl6advent.wordpress.com/2009/12/23/day-23-lazy-fruits-from-the-gather-of-eden/', gid: '', };
</script>
<style type="text/css" id="syntaxhighlighteranchor"></style>
<script type="text/javascript">
	window.google_analytics_uacct = "UA-52447-2";
</script>

<script type="text/javascript">
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-52447-2']);
	_gaq.push(['_setDomainName', 'wordpress.com']);
	_gaq.push(['_initData']);
	_gaq.push(['_trackPageview']);

	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
	})();
</script>
</head>
<body class="single single-post postid-357 single-format-standard mp6 highlander-enabled highlander-light">
<div id="page">

<div id="header">
	<div id="headerimg" onclick=" location.href='https://perl6advent.wordpress.com';" style="cursor: pointer;">
		<h1><a href="https://perl6advent.wordpress.com/">Perl 6 Advent Calendar</a></h1>
		<div class="description">Something cool about Perl 6 every day</div>
	</div>
</div>
<hr />

	<div id="content" class="widecolumn">

	
		<div class="navigation">
			<div class="alignleft">&laquo; <a href="https://perl6advent.wordpress.com/2009/12/22/day-22-operator-overloading/" rel="prev">Day 22: Operator&nbsp;Overloading</a></div>
			<div class="alignright"><a href="https://perl6advent.wordpress.com/2009/12/24/day-24-the-perl-6-standard-grammar/" rel="next">Day 24: The Perl 6 standard&nbsp;grammar</a> &raquo;</div>
		</div>

		<div class="post-357 post type-post status-publish format-standard hentry category-2009 clear" id="post-357">
			<h2>Day 23: Lazy fruits from the gather of&nbsp;Eden</h2>
			<small class="single-by"><span class="by-author"><span class="sep">by</span> <span class="author vcard"><a class="url fn n" href="https://perl6advent.wordpress.com/author/brushingupmyknuth/" title="View all posts by carl" rel="author">carl</a></span> </span></small>

			<div class="entry">
				<p>Today&#8217;s gift is a construct not often seen in other languages. It&#8217;s an iterator builder! And it&#8217;s called <code>gather</code>.</p>
<p>But first, let&#8217;s try a bit of historical perspective. Many Perl people know their <code>map</code>, <code>grep</code> and <code>sort</code>, convenient functions to carry out simple list transformations, filterings and rankings without having to resort to <code>for</code> loops.</p>
<pre>my @squares = map { $_ * $_ }, @numbers;
my @primes  = grep { is-prime($_) }, @numbers;</pre>
<p>The <code>map</code> and <code>grep</code> constructs are especially powerful once we get comfortable with chaining them:</p>
<pre>my @children-of-single-moms =
    map  {  .children },
    grep { !.is-married },
    grep {  .gender == FEMALE },
         @citizens;</pre>
<p>(Note that <code>.children</code> may return one child, a list of several children or an empty list. <code>map</code> has a flattening influence on the lists thus produced, so the final result is a flat list of children.)</p>
<p>The chaining of <code>map</code> and <code>sort</code> gave rise to the famous <a href="http://en.wikipedia.org/wiki/Schwartzian_transform">Schwartzian transform</a>, a Perl 5 caching idiom for when the thing being sorted on is computationally expensive:</p>
<pre>my @files-by-modification-date =
    map  { .[0] },                # deconstruct
    sort { $^a[1] &lt;=&gt; $^b[1] },
    map  { [$_, $_ ~~ :M] },      # compute and construct
         @files;</pre>
<p>It&#8217;s unfortunate that the functional paradigm puts the steps in reverse order of processing. The proposed pipe syntax, notably the <code>==&gt;</code>, would solve that. But it&#8217;s not implemented in Rakudo yet, only described in S03.</p>
<p>Anyway, if you&#8217;ve read the post from <a href="https://perl6advent.wordpress.com/2009/12/20/day-20-little-big-things/">day 20</a>, you know that the Schwartzian transform is built into <code>sort</code> nowadays:</p>
<pre>my @files-by-modification-date =
    sort { $_ ~~ :M },
    @files;</pre>
<p>So that&#8217;s, you know, <a href="http://www.youtube.com/watch?v=apEZpYnN_1g">coming along</a>.</p>
<p>Now, what about this <code>gather</code> construct? Well, it&#8217;s a kind of generalization of <code>map</code> and <code>grep</code>.</p>
<pre>sub mymap(&amp;transform, @list) {
    gather for @list {
        take transform($_);
    }
};

sub mygrep(&amp;condition, @list) {
    gather for @list {
        take $_ if condition($_);
    }
};</pre>
<p>(The real <code>map</code> can swallow several argument at a time, making it more powerful than the <code>&amp;mymap</code> above.)</p>
<p>Just to be clear about what happens: <code>gather</code> signals that within the subsequent block, we&#8217;ll be building a list. Each <code>take</code> adds an element to the list. You could think of it as <code>push</code>ing to an anonymous array if you want:</p>
<pre>my @result = gather { take $_ for 5..7 }; # this...

my @result;
push @result, $_ for 5..7; # ...is the same as this</pre>
<p>Which brings us to the first property of <code>gather</code>: it&#8217;s the construct you can use for building lists when <code>map</code>, <code>grep</code> and <code>sort</code> aren&#8217;t sufficient. Of course, there&#8217;s no need to reinvent those constructions&#8230; but the fact that you can do that, or roll your own special variants, is kinda nice.</p>
<pre>sub incremental-concat(@list) {
  my $string-accumulator = "";
  gather for @list {
    # RAKUDO: The ~() is a workaround for [perl #62178]
    take ~($string-accumulator ~= $_);
  }
};

say incremental-concat(&lt;a b c&gt;).perl; # ["a", "ab", "abc"]</pre>
<p>The above is nicer than using <code>map</code>, since we need to manage the <code>$string-accumulator</code> between iterations.</p>
<p>(Implementing <code>&amp;incremental-concat</code> by hand is silly in an implementation which implements the <code>[\~]</code> operator. Just a short announcement to people who want to keep track of the extent to which Perl 6 is channeling APL. Rakudo doesn&#8217;t yet, though.)</p>
<p>The second property of <code>gather</code> is that while the <code>take</code> calls (of course) have to occur within the scope of a <code>gather</code> block, they do not necessarily have to occur in the <em>lexical</em> scope, only the <em>dynamic</em> scope. For those unfamiliar with the distinction, I think an example explains it best:</p>
<pre>sub traverse-tree-inorder(Tree $t) {
  traverse-tree-inorder($t.left) if $t.left;
  take transform($t);
  traverse-tree-inorder($t.right) if $t.right;
}

my $tree = ...;
my @all-nodes = gather traverse-tree-inorder($tree);</pre>
<p>See what&#8217;s happening here? We wrap the call to <code>&amp;traverse-tree-inorder</code> in a <code>gather</code> statement. The statement itself doesn&#8217;t <em>lexically</em> contain any <code>take</code> calls, but the called subroutine does, and the <code>take</code> in there remembers that it&#8217;s in a gather context. That&#8217;s what makes the <code>gather</code> context dynamic rather than lexical.</p>
<p>Just to hammer in the point, <code>traverse-tree-inorder</code> does lexical recursion on a tree structure, and no matter how far down the call stack we find ourselves, the values passed to <code>take</code> find their way back into the same anonymous array, rooted in the <code>gather</code> around the original call. It&#8217;s as if the anonymous array were implicitly passed around for us automatically as invisible arguments. Another way to view it is that the <code>gather</code> mode works orthogonally to the call stack, essentially not caring about how many calls down it is.</p>
<p>Should we be unfortunate enough to do a <code>take</code> outside of any <code>gather</code> block, we&#8217;ll get a warning at runtime.</p>
<p>I&#8217;ve saved the best till last: the third property of <code>gather</code>: it&#8217;s <em>lazy</em>.</p>
<p>What does &#8220;lazy&#8221; mean here? Well, to take the above tree-traversing code as an example: when the assignment to <code>@all-nodes</code> has executed, the tree hasn&#8217;t yet been traversed. Only when you access the first element of the array, <code>@all-nodes[0]</code>, does the traversal start. And it stops right after it finds the leftmost leaf node. Access <code>@all-nodes[1]</code>, and the traversal will resume from where it left off, run just enough to find the second node in the traversal, and then stop.</p>
<p>In short, the code within the gather block starts and stops in such a way that it never does more work than you&#8217;ve asked it to do. That&#8217;s lazy.</p>
<p>It&#8217;s essentially a model of <em>delayed execution</em>. Perl 6 promises to run the code inside your gather block, but only if it turns out that you actually need the information. Operationally, you can think of it as a separate thread that starts and stops, always doing the smallest possible amount of work to keep the main thread satisfied. But under the hood in a given implementation, it&#8217;s likely implemented by continuations â€” or, failing that, by painful, complicated cheating.</p>
<p>Now here&#8217;s the thing: most any array in Perl 6 has the lazy behavior by default, and things like reading all lines from a file are lazy by default, and not only <em>can</em> <code>map</code> and <code>grep</code> be implemented using <code>gather</code>; it turns out that they actually <em>are</em>, too. So <code>map</code> and <code>grep</code> are <em>also</em> lazy.</p>
<p>Now, it&#8217;s nice to know that values aren&#8217;t unnecessarily generated when you&#8217;re doing calculations with arrays&#8230; but the <em>really</em> nice thing is that lazy arrays open up the door for <em>stream-based programming</em> and, by extension, infinite arrays.</p>
<p>Unfortunately, laziness hasn&#8217;t landed in Rakudo yet. We&#8217;re nearly there though, so I don&#8217;t feel too bad dangling these examples in front of you, even though they will currently cause Rakudo to spin the fans of your computer and nothing more:</p>
<pre>my @natural-numbers = 0 .. Inf;

my @even-numbers  = 0, 2 ... *;    # arithmetic seq
my @odd-numbers   = 1, 3 ... *;
my @powers-of-two = 1, 2, 4 ... *; # geometric seq

my @squares-of-odd-numbers = map { $_ * $_ }, @odd-numbers;

sub enumerate-positive-rationals() { # with duplicates, but still
  take 1;
  for 1..Inf -&gt; $total {
    for 1..^$total Z reverse(1..^$total) -&gt; $numerator, $denominator {
      take $numerator / $denominator;
    }
  }
}

sub enumerate-all-rationals() {
  map { $_, -$_ }, enumerate-positive-rationals();
}

sub fibonacci() {
  gather {
    take 0;
    my ($last, $this) = 0, 1;
    loop { # infinitely!
      take $this;
      ($last, $this) = $this, $last + $this;
    }
  }
}
say fibonacci[10]; # 55

# Merge two sorted (potentially infinite) arrays
sub merge(@a, @b) {
  !@a &amp;&amp; !@b ?? () !!
  !@a        ?? @b !!
         !@b ?? @a !!
  (@a[0] &lt; @b[0] ?? @a.shift !! @b.shift, merge(@a, @b))
}

sub hamming-sequence() # 2**a * 3**b * 5**c, where { all(a,b,c) &gt;= 0 }
  gather {
    take 1;
    take $_ for
        merge( (map { 2 * $_ } hamming-sequence()),
               merge( (map { 3 * $_ }, hamming-sequence()),
                      (map { 5 * $_ }, hamming-sequence()) ));
  }
}</pre>
<p>(That last subroutine is a Perl 6 solution to the Hamming problem, described in <a href="http://hop.perl.plover.com/book/pdf/06InfiniteStreams.pdf">section 6.4</a> of mjd++&#8217;s Higher Order Perl. A seriously cool book, by the way. It builds iterators from scratch; we just use <code>gather</code> for the same result.)</p>
<p>Today&#8217;s obfu award goes to <a href="http://twitter.com/dbrunton">David Brunton</a>, who has written a Perl 6 tweet which draws a <a href="http://twitter.com/dbrunton/status/6898466666">rule #30 cellular automaton</a>, which also happens to look like a Christmas tree.</p>
<pre>$ perl6 -e 'my %r=[^8]&gt;&gt;.fmt("%03b") Z (0,1,1,1,1,0,0,0);\
say &lt;. X&gt;[my@i=0 xx 9,1,0 xx 9];\
for ^9 {say &lt;. X&gt;[@i=map {%r{@i[($_-1)%19,$_,($_+1)%19].join}},^19]};'
.........X.........
........XXX........
.......XX..X.......
......XX.XXXX......
.....XX..X...X.....
....XX.XXXX.XXX....
...XX..X....X..X...
..XX.XXXX..XXXXXX..
.XX..X...XXX.....X.
XX.XXXX.XX..X...XXX</pre>

<div class="wpa" style="position: relative; width:300px; text-align: center; padding: 0; margin: 10px auto; overflow: hidden; clear: both;">
<a style="position: absolute; text-align: left; display: block; font: 9px/1 sans-serif; text-decoration: underline;" href="http://en.wordpress.com/about-these-ads/" rel="nofollow">About these ads</a>
<script type="text/javascript">
		var wpcom_adclk_hovering = false;
		var wpcom_adclk_recorded = false;
		var wpcom_adclk_theme = "Kubrick";
		var wpcom_adclk_slot = "wpcom_below_post";
		var wpcom_adclk_network = ( typeof wpcom_adclk_network === "undefined" ) ? "" : wpcom_adclk_network ;

		jQuery(document).ready( function() {
			function wpcom_adclk_hover_yes() { wpcom_adclk_hovering = true; }
			function wpcom_adclk_hover_no() { wpcom_adclk_hovering = false; }
			jQuery(".wpa").click(wpcom_adclk_click);
			jQuery(".wpa iframe").hover( wpcom_adclk_hover_yes, wpcom_adclk_hover_no );
			jQuery(".wpa object").hover( wpcom_adclk_hover_yes, wpcom_adclk_hover_no );

			jQuery(window).blur( function() {
				if ( wpcom_adclk_hovering ) { wpcom_adclk_click(); }
			});
		});

		function wpcom_adclk_impression() {
			var stat_gif = document.location.protocol + "//stats.wordpress.com/g.gif?v=wpcom-no-pv";
			stat_gif += "&x_ads_imp_theme=" + wpcom_adclk_theme;
			stat_gif += "&x_ads_imp_placement="+wpcom_adclk_slot;
			stat_gif += "&x_ads_imp_network=" + wpcom_adclk_network;
			stat_gif += "&x_ads_imp_theme_network="+wpcom_adclk_theme+"_"+wpcom_adclk_network;
			new Image().src = stat_gif + "&baba=" + Math.random();
			return true;
		}

		function wpcom_adclk_click() {
			if (wpcom_adclk_recorded) { return true; } // no double counting
			var stat_gif = document.location.protocol + "//stats.wordpress.com/g.gif?v=wpcom-no-pv";
			stat_gif += "&x_ads_click_theme=" + wpcom_adclk_theme;
			stat_gif += "&x_ads_click_placement="+wpcom_adclk_slot;
			stat_gif += "&x_ads_click_network=" + wpcom_adclk_network;
			stat_gif += "&x_ads_click_theme_network="+wpcom_adclk_theme+"_"+wpcom_adclk_network;

			new Image().src = stat_gif + "&baba=" + Math.random();
			wpcom_adclk_recorded = true;
			var now=new Date(); var end=now.getTime()+250;
			while(true){now=new Date();if(now.getTime()>end){break;}}
			return true;
		}
	
if ( typeof GA_googleAddAttr == 'function' ) {
GA_googleAddAttr("AdOpt", "1");
GA_googleAddAttr("Origin", "other");
GA_googleAddAttr("LangId", "1");
GA_googleAddAttr("Domain", "perl6advent.wordpress.com");
GA_googleAddAttr("BlogId", "10740073");
GA_googleAddAttr("PageURL", "https://perl6advent.wordpress.com/2009/12/23/day-23-lazy-fruits-from-the-gather-of-eden/");
GA_googleAddAttr("Autotag", "technology");
GA_googleAddAttr("Autotag", "science");
GA_googleAddAttr("Autotag", "books");
GA_googleAddAttr("Tag", "2009");
GA_googleAddAttr("theme_bg", "ffffff");
GA_googleAddAttr("theme_text", "333333");
GA_googleAddAttr("theme_link", "0066cc");
GA_googleAddAttr("theme_border", "f9f9f9");
GA_googleAddAttr("theme_url", "114477");
GA_googleAddAdSensePageAttr("google_page_url", "https://perl6advent.wordpress.com/2009/12/23/day-23-lazy-fruits-from-the-gather-of-eden/");
GA_googleFillSlot("wpcom_below_post");
}
</script>
</div>
<style type="text/css">
div.wpa>div { margin-top: 1em; } #google_ads_div_wpcom_below_post_adsafe_ad_container { display: block !important; }
</style>
<script type="text/javascript">
jQuery( window ).load( function() {
    if ( jQuery(".wpa script[src*='virool.com']").length > 0 || jQuery(".wpa script[src*='shareth.ru']").length > 0 || jQuery(".wpa iframe[src*='boomvideo.tv']").length > 0 || jQuery(".wpa iframe[src*='viewablemedia.net']").length > 0 || jQuery(".wpa .sharethrough-placement").length > 0 ) {
        jQuery( '.wpa' ).css( 'width', '400px' );
    }
setTimeout(function(){if(typeof GS_googleAddAdSenseService !== 'function'){new Image().src=document.location.protocol+"//stats.wordpress.com/g.gif?v=wpcom-no-pv&x_noads=adblock&baba="+Math.random()}},100);
} );
</script>
<div id="jp-post-flair" class="sharedaddy sd-like-enabled"><div class='sharedaddy sd-block sd-like jetpack-likes-widget-wrapper jetpack-likes-widget-unloaded' id='like-post-wrapper-10740073-357-534cd1581d0a7' data-src='//widgets.wp.com/likes/#blog_id=10740073&amp;post_id=357&amp;origin=perl6advent.wordpress.com&amp;obj_id=10740073-357-534cd1581d0a7' data-name='like-post-frame-10740073-357-534cd1581d0a7'><h3 class='sd-title'>Like this:</h3><div class='likes-widget-placeholder post-likes-widget-placeholder' style='height:55px'><span class='button'><span>Like</span></span> <span class="loading">Loading...</span></div><span class='sd-text-color'></span><a class='sd-link-color'></a></div>
<div id='jp-relatedposts' class='jp-relatedposts' >
	<h3 class="jp-relatedposts-headline"><em>Related</em></h3>
</div></div>
								
				<p class="postmetadata alt">
					<small>
												This entry was posted on December 23, 2009 at 12:01 am and is filed under <a href="https://perl6advent.wordpress.com/category/2009/" title="View all posts in 2009" rel="category tag">2009</a>.						You can follow any responses to this entry through the <a href='https://perl6advent.wordpress.com/2009/12/23/day-23-lazy-fruits-from-the-gather-of-eden/feed/'>RSS 2.0</a> feed.
													You can <a href="#respond">leave a response</a>, or <a href="https://perl6advent.wordpress.com/2009/12/23/day-23-lazy-fruits-from-the-gather-of-eden/trackback/" rel="trackback">trackback</a> from your own site.
						
					</small>
				</p>

			</div>
		</div>

	
<!-- You can start editing here. -->
	<h3 id="comments">9 Responses to &#8220;Day 23: Lazy fruits from the gather of&nbsp;Eden&#8221;</h3>

	<ol class="commentlist">
					<li class="comment even thread-even depth-1 highlander-comment" id="comment-201">
			<img alt='' src='https://1.gravatar.com/avatar/a123a070ab3c9dca76acc66acf8ec93a?s=32&#038;d=identicon&#038;r=G' class='avatar avatar-32' height='32' width='32' />			<cite><a href='http://mina86.com/' rel='external nofollow' class='url'>mina86</a></cite> Says:						<br />

			<small class="commentmetadata"><a href="#comment-201" title="">December 23, 2009 at 12:50 am</a> | <a class='comment-reply-link' href='/2009/12/23/day-23-lazy-fruits-from-the-gather-of-eden/?replytocom=201#respond' onclick='return addComment.moveForm("comment-201", "201", "respond", "357")'>Reply</a> </small>

			<p>In Haskell one can write something like (written in Perl code):</p>
<p>@fibs = (0, 1, (@fibs &gt;&gt;+&lt;&lt; @fibs[1 .. Inf]))</p>
<p>ie. you construct the list by referring to itself. Would something like that be possible in Perl6?</p>
<ul class="children">
			<li class="comment byuser comment-author-brushingupmyknuth bypostauthor odd alt depth-2 highlander-comment" id="comment-206">
			<img alt='' src='https://2.gravatar.com/avatar/2d9d4815e8e5927a4e04cdea13ca1e36?s=32&#038;d=identicon&#038;r=G' class='avatar avatar-32' height='32' width='32' />			<cite>carl</cite> Says:						<br />

			<small class="commentmetadata"><a href="#comment-206" title="">December 23, 2009 at 7:27 am</a> | <a class='comment-reply-link' href='/2009/12/23/day-23-lazy-fruits-from-the-gather-of-eden/?replytocom=206#respond' onclick='return addComment.moveForm("comment-206", "206", "respond", "357")'>Reply</a> </small>

			<p>Yes; that&#8217;s the technique I&#8217;m using to construct the Hamming sequence in the post, i.e. creating an infinite sequence which is defined in terms of itself.</p>
<p>Pugs once did something very much like the code you propose above (but used <code>:=</code> binding, if I recall correctly). Last I heard, that semantics has fallen out of favour, and I&#8217;d recommend using a subroutine instead. Also, fib is less complicated than hamming-sequence, so no need to use the merge function.</p>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
			<li class="comment even thread-odd thread-alt depth-1 highlander-comment" id="comment-268">
			<img alt='' src='https://2.gravatar.com/avatar/55502f40dc8b7c769880b10874abc9d0?s=32&#038;d=identicon&#038;r=G' class='avatar avatar-32' height='32' width='32' />			<cite>reply</cite> Says:						<br />

			<small class="commentmetadata"><a href="#comment-268" title="">January 13, 2010 at 6:15 pm</a> | <a class='comment-reply-link' href='/2009/12/23/day-23-lazy-fruits-from-the-gather-of-eden/?replytocom=268#respond' onclick='return addComment.moveForm("comment-268", "268", "respond", "357")'>Reply</a> </small>

			<p>When I read that &#8220;take&#8221; may occur anywhere not only in the lexical scope, I ask myself if it&#8217;s implemented using some kind of global variable.</p>
<p>I.e. if I build an array like:</p>
<p>my @very_private_array = map { some_function_from_some_other_module(); 2 * $_ } 1..10;</p>
<p>and the foreign function happens to be nasty and likes to call &#8220;take&#8221; out of the blue, will that modify my array?</p>
<ul class="children">
			<li class="comment byuser comment-author-brushingupmyknuth bypostauthor odd alt depth-2 highlander-comment" id="comment-269">
			<img alt='' src='https://2.gravatar.com/avatar/2d9d4815e8e5927a4e04cdea13ca1e36?s=32&#038;d=identicon&#038;r=G' class='avatar avatar-32' height='32' width='32' />			<cite>carl</cite> Says:						<br />

			<small class="commentmetadata"><a href="#comment-269" title="">January 14, 2010 at 10:01 am</a> | <a class='comment-reply-link' href='/2009/12/23/day-23-lazy-fruits-from-the-gather-of-eden/?replytocom=269#respond' onclick='return addComment.moveForm("comment-269", "269", "respond", "357")'>Reply</a> </small>

			<p>You are correct.</p>
<pre>
$ perl6 -e 'sub foo { take 42 }; my @a = map { foo; $_ }, 1..3; say @a.perl'
[42, 1, 42, 2, 42, 3]
</pre>
<p>What you call &#8220;some kind of global&#8221; variable is probably a dynamic variable, i.e. one following dynamic scoping rules rather than lexical ones.</p>
<p>I agree that what you describe is slightly problematic, in that it feels a bit &#8220;too powerful&#8221; &#8212; should foreign modules be able to affect the purity of my <code>map</code> call? Also, just because <code>map</code> is defined using <code>gather</code> in Rakudo doesn&#8217;t mean that it will be in all implementations of Perl 6. Thus your example, and mine, should probably be considered implementation-dependent code, and thus avoidable.</p>
<p>Maybe that&#8217;s it. At least until I or someone else comes up with a good technical patch for the problem you envision, the solution is social, and the way to live with the fact that calling an impure foreign function inside a <code>map</code> block can lead to unexpected return values, is &#8220;well, don&#8217;t do that&#8221;.</p>
<ul class="children">
			<li class="comment even depth-3 highlander-comment" id="comment-271">
			<img alt='' src='https://2.gravatar.com/avatar/55502f40dc8b7c769880b10874abc9d0?s=32&#038;d=identicon&#038;r=G' class='avatar avatar-32' height='32' width='32' />			<cite>reply</cite> Says:						<br />

			<small class="commentmetadata"><a href="#comment-271" title="">January 15, 2010 at 6:16 pm</a> </small>

			<p>I think this could produce bugs that are hard to trace.  This is a bit like in Perl 5 when subroutines modify $_ by accident (maybe because of a typo or something). This confuses the outer subroutines and produces strange behaviour. This is particularly hard to fix if the inner subroutine is in a module and I did not read its code. I am happy that for $_ this problem disappears in Perl 6.</p>
<p>As for my example code: As the map block runs lazily, code like this could be used to e.g. display a message whenever a new number for the array is computed. Suppose &#8220;2 * $_&#8221; is replaced by some computation that takes some time, and some_function_from_some_other_module is used to print a banner that displays something like &#8220;please wait while we compute the next number&#8221;. In this case, the function is invoked only for its side effects, and the programmer would not expect that there is any chance that it might pollute the resulting array by inadvertently calling &#8220;take&#8221; without &#8220;gather&#8221;.</p>
<p>This is not only problematic for &#8220;map&#8221;, but for ordinary uses of gather/take, too, I suppose.</p>
<p>Just my two cents.</p>
</li><!-- #comment-## -->
			<li class="comment byuser comment-author-brushingupmyknuth bypostauthor odd alt depth-3 highlander-comment" id="comment-272">
			<img alt='' src='https://2.gravatar.com/avatar/2d9d4815e8e5927a4e04cdea13ca1e36?s=32&#038;d=identicon&#038;r=G' class='avatar avatar-32' height='32' width='32' />			<cite>carl</cite> Says:						<br />

			<small class="commentmetadata"><a href="#comment-272" title="">January 15, 2010 at 6:25 pm</a> </small>

			<p>I agree with you that this could be a problem. I&#8217;m not sure how big of one it would be in practice. Nor do I have even the beginning of a fix to that problem that would retain the flexibility of a dynamic gather/take in the scenarios when you <em>do</em> want the effect you&#8217;re describing. (One case where the dynamical-ness turns out to be very useful is when traversing a tree structure, for example.)</p>
</li><!-- #comment-## -->
			<li class="comment even depth-3 highlander-comment" id="comment-273">
			<img alt='' src='https://2.gravatar.com/avatar/55502f40dc8b7c769880b10874abc9d0?s=32&#038;d=identicon&#038;r=G' class='avatar avatar-32' height='32' width='32' />			<cite>reply</cite> Says:						<br />

			<small class="commentmetadata"><a href="#comment-273" title="">January 15, 2010 at 10:45 pm</a> </small>

			<p>Maybe it would be a fix if &#8220;gather&#8221; and &#8220;take&#8221; were matched only if they are in the same file (or module or something like that).</p>
</li><!-- #comment-## -->
			<li class="comment byuser comment-author-brushingupmyknuth bypostauthor odd alt depth-3 highlander-comment" id="comment-276">
			<img alt='' src='https://2.gravatar.com/avatar/2d9d4815e8e5927a4e04cdea13ca1e36?s=32&#038;d=identicon&#038;r=G' class='avatar avatar-32' height='32' width='32' />			<cite>carl</cite> Says:						<br />

			<small class="commentmetadata"><a href="#comment-276" title="">January 16, 2010 at 1:00 am</a> </small>

			<p>Maybe it would, but it also feels a bit arbitrary. Does that mean that providing tree traversal callbacks from another file or module is out of the question? Why?</p>
<p>I don&#8217;t think it&#8217;s up to the compiler to detect dubious cases of &#8216;take without gather&#8217;, but maybe a sufficiently brave static analyzer could catch some common errors.</p>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
			<li class="comment byuser comment-author-brushingupmyknuth bypostauthor even depth-2 highlander-comment" id="comment-270">
			<img alt='' src='https://2.gravatar.com/avatar/2d9d4815e8e5927a4e04cdea13ca1e36?s=32&#038;d=identicon&#038;r=G' class='avatar avatar-32' height='32' width='32' />			<cite>carl</cite> Says:						<br />

			<small class="commentmetadata"><a href="#comment-270" title="">January 14, 2010 at 1:57 pm</a> | <a class='comment-reply-link' href='/2009/12/23/day-23-lazy-fruits-from-the-gather-of-eden/?replytocom=270#respond' onclick='return addComment.moveForm("comment-270", "270", "respond", "357")'>Reply</a> </small>

			<p>More generally, there will always be some level at which you&#8217;ll be able to subvert even the built-ins of Perl 6, it being self-hosting. The pipes are showing, and they can sometimes be bent in ways not originally intended.</p>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	</ol>

	<div class="navigation">
		<div class="alignleft"></div>
		<div class="alignright"></div>
	</div>



								<div id="respond" class="comment-respond">
				<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/2009/12/23/day-23-lazy-fruits-from-the-gather-of-eden/#respond" style="display:none;">Cancel reply</a></small></h3>
									<form action="https://perl6advent.wordpress.com/wp-comments-post.php" method="post" id="commentform" class="comment-form">
																										


												<input type="hidden" id="highlander_comment_nonce" name="highlander_comment_nonce" value="69292a17f8" /><input type="hidden" name="_wp_http_referer" value="/2009/12/23/day-23-lazy-fruits-from-the-gather-of-eden/" />
<input type="hidden" name="hc_post_as" id="hc_post_as" value="guest" />

<div class="comment-form-field comment-textarea">
	<label for="comment">Enter your comment here...</label>
	<div id="comment-form-comment"><textarea id="comment" name="comment" title="Enter your comment here..."></textarea></div>
</div>

<div id="comment-form-identity">

	<div id="comment-form-nascar">
		<p>Fill in your details below or click an icon to log in:</p>
		<ul>
			<li class="selected" style="display:none;">
				<a href="#comment-form-guest" id="postas-guest" title="Guest">
					<span></span>
				</a>
			</li>
			<li>
				<a href="#comment-form-load-service:WordPress.com" id="postas-wordpress" title="WordPress.com">
					<span></span>
				</a>
			</li>
			<li>
				<a href="#comment-form-load-service:Twitter" id="postas-twitter" title="Twitter">
					<span></span>
				</a>
			</li>
			<li>
				<a href="#comment-form-load-service:Facebook" id="postas-facebook" title="Facebook">
					<span></span>
				</a>
			</li>
			<li>
			<iframe id="googleplus-sign-in" name="googleplus-sign-in" src="https://public-api.wordpress.com/connect/?googleplus-sign-in=https%3A%2F%2Fperl6advent.wordpress.com" width="24" height="24" scrolling="no" allowtransparency="true" seamless="seamless" frameborder="0"></iframe>
			</li>
		</ul>
	</div>

	<div id="comment-form-guest" class="comment-form-service selected">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
<a href="https://gravatar.com/site/signup/" target="_blank">				<img src="https://1.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=25&amp;d=identicon&amp;forcedefault=y&amp;r=G" alt="Gravatar" width="25" class="no-grav" />
</a>			</div>

				<div class="comment-form-fields">
				<div class="comment-form-field comment-form-email">
					<label for="email">Email <span class="required">(required)</span> <span class="nopublish">(Address never made public)</span></label>
					<div class="comment-form-input"><input id="email" name="email" type="email" value="" /></div>
				</div>
				<div class="comment-form-field comment-form-author">
					<label for="author">Name <span class="required">(required)</span></label>
					<div class="comment-form-input"><input id="author" name="author" type="text" value="" /></div>
				</div>
				<div class="comment-form-field comment-form-url">
					<label for="url">Website</label>
					<div class="comment-form-input"><input id="url" name="url" type="text" value="" /></div>
				</div>
			</div>
	
		</div>
	</div>

	<div id="comment-form-wordpress" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="https://s2.wp.com/wp-content/mu-plugins/highlander-comments/images/wplogo.png" alt="WordPress.com Logo" width="25" class="no-grav" />
			</div>

				<div class="comment-form-fields">
				<input type="hidden" name="wp_avatar" id="wordpress-avatar" class="comment-meta-wordpress" value="" />
				<input type="hidden" name="wp_user_id" id="wordpress-user_id" class="comment-meta-wordpress" value="" />
				<input type="hidden" name="wp_access_token" id="wordpress-access_token" class="comment-meta-wordpress" value="" />
				<p class="comment-form-posting-as pa-wordpress"><strong></strong> You are commenting using your WordPress.com account. <span class="comment-form-log-out">(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout( 'wordpress' );">Log&nbsp;Out</a>&nbsp;/&nbsp;<a href="#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)</span></p>
			</div>
	
		</div>
	</div>

	<div id="comment-form-twitter" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="https://1.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=25&amp;d=identicon&amp;forcedefault=y&amp;r=G" alt="Twitter picture" width="25" class="no-grav" />
			</div>

				<div class="comment-form-fields">
				<input type="hidden" name="twitter_avatar" id="twitter-avatar" class="comment-meta-twitter" value="" />
				<input type="hidden" name="twitter_user_id" id="twitter-user_id" class="comment-meta-twitter" value="" />
				<input type="hidden" name="twitter_access_token" id="twitter-access_token" class="comment-meta-twitter" value="" />
				<p class="comment-form-posting-as pa-twitter"><strong></strong> You are commenting using your Twitter account. <span class="comment-form-log-out">(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout( 'twitter' );">Log&nbsp;Out</a>&nbsp;/&nbsp;<a href="#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)</span></p>
			</div>
	
		</div>
	</div>

	<div id="comment-form-facebook" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="https://1.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=25&amp;d=identicon&amp;forcedefault=y&amp;r=G" alt="Facebook photo" width="25" class="no-grav" />
			</div>

				<div class="comment-form-fields">
				<input type="hidden" name="fb_avatar" id="facebook-avatar" class="comment-meta-facebook" value="" />
				<input type="hidden" name="fb_user_id" id="facebook-user_id" class="comment-meta-facebook" value="" />
				<input type="hidden" name="fb_access_token" id="facebook-access_token" class="comment-meta-facebook" value="" />
				<p class="comment-form-posting-as pa-facebook"><strong></strong> You are commenting using your Facebook account. <span class="comment-form-log-out">(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout( 'facebook' );">Log&nbsp;Out</a>&nbsp;/&nbsp;<a href="#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)</span></p>
			</div>
	
		</div>
	</div>

	<div id="comment-form-googleplus" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="https://1.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=25&amp;d=identicon&amp;forcedefault=y&amp;r=G" alt="Google+ photo" width="25" class="no-grav" />
			</div>

				<div class="comment-form-fields">
				<input type="hidden" name="googleplus_avatar" id="googleplus-avatar" class="comment-meta-googleplus" value="" />
				<input type="hidden" name="googleplus_user_id" id="googleplus-user_id" class="comment-meta-googleplus" value="" />
				<input type="hidden" name="googleplus_access_token" id="googleplus-access_token" class="comment-meta-googleplus" value="" />
				<p class="comment-form-posting-as pa-googleplus"><strong></strong> You are commenting using your Google+ account. <span class="comment-form-log-out">(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout( 'googleplus' );">Log&nbsp;Out</a>&nbsp;/&nbsp;<a href="#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)</span></p>
			</div>
	
		</div>
	</div>


	<div id="comment-form-load-service" class="comment-form-service">
		<div class="comment-form-posting-as-cancel"><a href="javascript:HighlanderComments.cancelExternalWindow();">Cancel</a></div>
		<p>Connecting to %s</p>
	</div>

	
</div>

<script type="text/javascript">
var highlander_expando_javascript = function(){
	var input = document.createElement( 'input' ),
	    comment = jQuery( '#comment' );

	if ( 'placeholder' in input ) {
		comment.attr( 'placeholder', jQuery( '.comment-textarea label' ).remove().text() );
	}

	// Expando Mode: start small, then auto-resize on first click + text length
	jQuery( '#comment-form-identity' ).hide();
	jQuery( '#comment-form-subscribe' ).hide();
	jQuery( '#commentform .form-submit' ).hide();

	comment.css( { 'height':'10px' } ).one( 'focus', function() {
		var timer = setInterval( HighlanderComments.resizeCallback, 10 )
		jQuery( this ).animate( { 'height': HighlanderComments.initialHeight } ).delay( 100 ).queue( function(n) { clearInterval( timer ); HighlanderComments.resizeCallback(); n(); } );
		jQuery( '#comment-form-identity' ).slideDown();
		jQuery( '#comment-form-subscribe' ).slideDown();
		jQuery( '#commentform .form-submit' ).slideDown();
	});
}
jQuery(document).ready( highlander_expando_javascript );
</script>

<div id="comment-form-subscribe">
	<p class="comment-subscription-form"><input type="checkbox" name="subscribe" id="subscribe" value="subscribe" style="width: auto;" tabindex="6"/> <label class="subscribe-label" id="subscribe-label" for="subscribe" style="display: inline;">Notify me of follow-up comments via email.</label></p></div>

												<p class="form-submit">
							<input name="submit" type="submit" id="comment-submit" value="Post Comment" />
							<input type='hidden' name='comment_post_ID' value='357' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
						</p>
						
<input type="hidden" name="genseq" value="1397543256" />
<p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="6e050feaa0" /></p><script type='text/javascript' src='https://s2.wp.com/wp-content/mu-plugins/akismet-2.5/form.js?m=1308783962g'></script>
<p style="display: none;"><input type="hidden" id="ak_js" name="ak_js" value="148"/></p>					</form>
							</div><!-- #respond -->
			<div style="clear: both"></div>

	
	</div>


<hr />
<div id="footer">
	<p>
		<a href="http://theme.wordpress.com/themes/kubrick/" title="Learn more about this theme">The Kubrick Theme</a> <a href="http://wordpress.com/?ref=footer">Blog at WordPress.com</a>.
		<br /><a href="https://perl6advent.wordpress.com/feed/">Entries (RSS)</a> and <a href="https://perl6advent.wordpress.com/comments/feed/">Comments (RSS)</a>.	</p>
</div>
</div>

<script type='text/javascript' src='//0.gravatar.com/js/gprofiles.js?ver=201416x'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type='text/javascript' src='https://s2.wp.com/wp-content/mu-plugins/gravatar-hovercards/wpgroho.js?m=1380573781g'></script>

	<script>
		//initialize and attach hovercards to all gravatars
		jQuery( document ).ready( function( $ ) {
			Gravatar.profile_cb = function( hash, id ) {
				WPGroHo.syncProfileData( hash, id );
			};
			Gravatar.my_hash = WPGroHo.my_hash;
			Gravatar.init( 'body', '#wp-admin-bar-my-account' );
		});
	</script>

		<div style="display:none">
	<div class="grofile-hash-map-a123a070ab3c9dca76acc66acf8ec93a">
	</div>
	<div class="grofile-hash-map-2d9d4815e8e5927a4e04cdea13ca1e36">
	</div>
	<div class="grofile-hash-map-55502f40dc8b7c769880b10874abc9d0">
	</div>
	</div>
<script type='text/javascript'>
/* <![CDATA[ */
var HighlanderComments = {"loggingInText":"Logging In\u2026","submittingText":"Posting Comment\u2026","postCommentText":"Post Comment","connectingToText":"Connecting to %s","commentingAsText":"%1$s: You are commenting using your %2$s account.","logoutText":"Log Out","loginText":"Log In","connectURL":"https:\/\/perl6advent.wordpress.com\/public.api\/connect\/?action=request","logoutURL":"https:\/\/perl6advent.wordpress.com\/wp-login.php?action=logout&_wpnonce=f3284f6283","homeURL":"https:\/\/perl6advent.wordpress.com\/","postID":"357","gravDefault":"identicon","enterACommentError":"Please enter a comment","enterEmailError":"Please enter your email address here","invalidEmailError":"Invalid email address","enterAuthorError":"Please enter your name here","gravatarFromEmail":"This picture will show whenever you leave a comment. Click to customize it.","logInToExternalAccount":"Log in to use details from one of these accounts.","change":"Change","changeAccount":"Change Account","comment_registration":"","userIsLoggedIn":"","isJetpack":"0"};
/* ]]> */
</script>
<script type='text/javascript' src='https://s0.wp.com/_static/??/wp-content/js/jquery/jquery.autoresize.js,/wp-content/mu-plugins/highlander-comments/script.js?m=1395185286j'></script>

	<div id="bit" class="loggedout-follow-normal">
		<a class="bsub" href="javascript:void(0)"><span id='bsub-text'>Follow</span></a>
		<div id="bitsubscribe">

					<h3><label for="loggedout-follow-field">Follow &ldquo;Perl 6 Advent Calendar&rdquo;</label></h3>

			<form action="https://subscribe.wordpress.com" method="post" accept-charset="utf-8" id="loggedout-follow">
			<p>Get every new post delivered to your Inbox.</p>

			<p id="loggedout-follow-error" style="display: none;"></p>

						<p class="bit-follow-count">Join 36 other followers</p>
			<p><input type="email" name="email" value="Enter your email address" onfocus='this.value=(this.value=="Enter your email address") ? "" : this.value;' onblur='this.value=(this.value=="") ? "Enter email address" : this.value;'  id="loggedout-follow-field"/></p>

			<input type="hidden" name="action" value="subscribe"/>
			<input type="hidden" name="blog_id" value="10740073"/>
			<input type="hidden" name="source" value="https://perl6advent.wordpress.com/2009/12/23/day-23-lazy-fruits-from-the-gather-of-eden/"/>
			<input type="hidden" name="sub-type" value="loggedout-follow"/>

			<input type="hidden" id="_wpnonce" name="_wpnonce" value="012dea5bde" /><input type="hidden" name="_wp_http_referer" value="/2009/12/23/day-23-lazy-fruits-from-the-gather-of-eden/" />
			<p id='bsub-subscribe-button'><input type="submit" value="Sign me up" /></p>
			</form>
					<div id='bsub-credit'><a href="http://wordpress.com/signup/?ref=lof">Powered by WordPress.com</a></div>
		</div><!-- #bitsubscribe -->
	</div><!-- #bit -->
	<script type="text/javascript">
	var skimlinks_pub_id = "725X584219"
	var skimlinks_sitename = "perl6advent.wordpress.com";
	</script>
	<script type="text/javascript" src="https://s.skimresources.com/js/725X1342.skimlinks.js"></script>		<iframe src='https://widgets.wp.com/likes/master.html?ver=20140227#ver=20140227&amp;mp6=1' scrolling='no' id='likes-master' name='likes-master' style='display:none;'></iframe>
		<div id='likes-other-gravatars'><div class="likes-text"><span>%d</span> bloggers like this:</div><ul class="wpl-avatars sd-like-gravatars"></ul></div>
		<script type="text/javascript">
		//<![CDATA[
			var jetpackLikesWidgetQueue = [];
			var jetpackLikesWidgetBatch = [];
			var jetpackLikesMasterReady = false;

			function JetpackLikespostMessage( message, target ) {
				if ( "string" === typeof message ){
					try{
						message = JSON.parse( message );
					}
					catch(e) {
						return;
					}
				}

				pm( {
					target: target,
					type: 'likesMessage',
					data: message,
					origin: '*'
				} );
			}

			function JetpackLikesBatchHandler() {
				var requests = [];
				jQuery( 'div.jetpack-likes-widget-unloaded' ).each( function( i ) {
					if ( jetpackLikesWidgetBatch.indexOf( this.id ) > -1 )
						return;
					jetpackLikesWidgetBatch.push( this.id );
					var regex = /like-(post|comment)-wrapper-(\d+)-(\d+)-(\w+)/;
					var match = regex.exec( this.id );
					if ( ! match || match.length != 5 )
						return;

					var info = {
						blog_id: match[2],
						width:   this.width
					};

					if ( 'post' == match[1] ) {
						info.post_id = match[3];
					} else if ( 'comment' == match[1] ) {
						info.comment_id = match[3];
					}

					info.obj_id = match[4];

					requests.push( info );
				});

				if ( requests.length > 0 ) {
					JetpackLikespostMessage( { event: 'initialBatch', requests: requests }, window.frames['likes-master'] );
				}
			}

			function JetpackLikesMessageListener( event ) {
				if ( "undefined" == typeof event.event )
					return;

				if ( 'masterReady' == event.event ) {
					jQuery( document ).ready( function() {
						jetpackLikesMasterReady = true;

						var stylesData = {
								event: 'injectStyles'
						};

						if ( jQuery( 'iframe.admin-bar-likes-widget' ).length > 0 ) {
							JetpackLikespostMessage( { event: 'adminBarEnabled' }, window.frames[ 'likes-master' ] );

							stylesData.adminBarStyles = {
								background: jQuery( '#wpadminbar .quicklinks li#wp-admin-bar-wpl-like > a' ).css( 'background' ),
								isRtl: ( 'rtl' == jQuery( '#wpadminbar' ).css( 'direction' ) )
							};
						}

						if ( !window.addEventListener )
							jQuery( '#wp-admin-bar-admin-bar-likes-widget' ).hide();

						stylesData.textStyles = {
							color: jQuery( '.sd-text-color').css( 'color' ),
							fontFamily: jQuery( '.sd-text-color' ).css( 'font-family' ),
							fontSize: jQuery( '.sd-text-color' ).css( 'font-size' ),
							direction: jQuery( '.sd-text-color' ).css( 'direction' ),
							fontWeight: jQuery( '.sd-text-color' ).css( 'font-weight' ),
							fontStyle: jQuery( '.sd-text-color' ).css( 'font-style' ),
							textDecoration: jQuery( '.sd-text-color' ).css('text-decoration')
						};

						stylesData.linkStyles = {
							color: jQuery( '.sd-link-color' ).css('color'),
							fontFamily: jQuery( '.sd-link-color' ).css('font-family'),
							fontSize: jQuery( '.sd-link-color' ).css('font-size'),
							textDecoration: jQuery( '.sd-link-color' ).css('text-decoration'),
							fontWeight: jQuery( '.sd-link-color' ).css( 'font-weight' ),
							fontStyle: jQuery( '.sd-link-color' ).css( 'font-style' )
						};

						JetpackLikespostMessage( stylesData, window.frames[ 'likes-master' ] );

						JetpackLikesBatchHandler();

						jQuery( document ).on( 'inview', 'div.jetpack-likes-widget-unloaded', function() {
							jetpackLikesWidgetQueue.push( this.id );
						});
					});
				}

				if ( 'showLikeWidget' == event.event ) {
					jQuery( '#' + event.id + ' .post-likes-widget-placeholder'  ).fadeOut( 'fast', function() {
						jQuery( '#' + event.id + ' .post-likes-widget' ).fadeIn( 'fast', function() {
							JetpackLikespostMessage( { event: 'likeWidgetDisplayed', blog_id: event.blog_id, post_id: event.post_id, obj_id: event.obj_id }, window.frames['likes-master'] );
						});
					});
				}

				if ( 'clickReblogFlair' == event.event ) {
					wpcom_reblog.toggle_reblog_box_flair( event.obj_id );
				}

				if ( 'showOtherGravatars' == event.event ) {
					var $container = jQuery( '#likes-other-gravatars' );
					var $list = $container.find( 'ul' );

					$container.hide();
					$list.html( '' );

					$container.find( '.likes-text span' ).text( event.total );

					jQuery.each( event.likers, function( i, liker ) {
						$list.append( '<li class="' + liker.css_class + '"><a href="' + liker.profile_URL + '" class="wpl-liker" rel="nofollow" target="_parent"><img src="' + liker.avatar_URL + '" alt="' + liker.name + '" width="30" height="30" style="padding-right: 3px;" /></a></li>');
					} );

					var offset = jQuery( "[name='" + event.parent + "']" ).offset();

					$container.css( 'left', offset.left + event.position.left - 10 + 'px' );
					$container.css( 'top', offset.top + event.position.top - 33 + 'px' );

					var rowLength = Math.floor( event.width / 37 );
					var height = ( Math.ceil( event.likers.length / rowLength ) * 37 ) + 13;
					if ( height > 204 ) {
						height = 204;
					}

					$container.css( 'height', height + 'px' );
					$container.css( 'width', rowLength * 37 - 7 + 'px' );

					$list.css( 'width', rowLength * 37 + 'px' );

					$container.fadeIn( 'slow' );

					var scrollbarWidth = $list[0].offsetWidth - $list[0].clientWidth;
					if ( scrollbarWidth > 0 ) {
						$container.width( $container.width() + scrollbarWidth );
						$list.width( $list.width() + scrollbarWidth );
					}
				}
			}

			pm.bind( 'likesMessage', function(e) { JetpackLikesMessageListener(e); } );

			jQuery( document ).click( function( e ) {
				var $container = jQuery( '#likes-other-gravatars' );

				if ( $container.has( e.target ).length === 0 ) {
					$container.fadeOut( 'slow' );
				}
			});

			function JetpackLikesWidgetQueueHandler() {
				var wrapperID;
				if ( ! jetpackLikesMasterReady ) {
					setTimeout( JetpackLikesWidgetQueueHandler, 500 );
					return;
				}

				if ( jetpackLikesWidgetQueue.length > 0 ) {
					// We may have a widget that needs creating now
					var found = false;
					while( jetpackLikesWidgetQueue.length > 0 ) {
						// Grab the first member of the queue that isn't already loading.
						wrapperID = jetpackLikesWidgetQueue.splice( 0, 1 )[0];
						if ( jQuery( '#' + wrapperID ).hasClass( 'jetpack-likes-widget-unloaded' ) ) {
							found = true;
							break;
						}
					}
					if ( ! found ) {
						setTimeout( JetpackLikesWidgetQueueHandler, 500 );
						return;
					}
				} else if ( jQuery( 'div.jetpack-likes-widget-unloaded' ).length > 0 ) {
					// Grab any unloaded widgets for a batch request
					JetpackLikesBatchHandler();

					// Get the next unloaded widget
					wrapperID = jQuery( 'div.jetpack-likes-widget-unloaded' ).first()[0].id;
					if ( ! wrapperID ) {
						// Everything is currently loaded
						setTimeout( JetpackLikesWidgetQueueHandler, 500 );
						return;
					}
				}

				if ( 'undefined' === typeof wrapperID ) {
					setTimeout( JetpackLikesWidgetQueueHandler, 500 );
					return;
				}

				var $wrapper = jQuery( '#' + wrapperID );
				$wrapper.find( 'iframe' ).remove();

				if ( $wrapper.hasClass( 'slim-likes-widget' ) ) {
					$wrapper.find( '.post-likes-widget-placeholder' ).after( "<iframe class='post-likes-widget jetpack-likes-widget' name='" + $wrapper.data( 'name' ) + "' height='22px' width='68px' frameBorder='0' scrolling='no' src='" + $wrapper.data( 'src' ) + "'></iframe>" );
				} else {
					$wrapper.find( '.post-likes-widget-placeholder' ).after( "<iframe class='post-likes-widget jetpack-likes-widget' name='" + $wrapper.data( 'name' ) + "' height='55px' width='100%' frameBorder='0' src='" + $wrapper.data( 'src' ) + "'></iframe>" );
				}

				$wrapper.removeClass( 'jetpack-likes-widget-unloaded' ).addClass( 'jetpack-likes-widget-loading' );

				$wrapper.find( 'iframe' ).load( function( e ) {
					var $iframe = jQuery( e.target );
					$wrapper.removeClass( 'jetpack-likes-widget-loading' ).addClass( 'jetpack-likes-widget-loaded' );

					JetpackLikespostMessage( { event: 'loadLikeWidget', name: $iframe.attr( 'name' ), width: $iframe.width() }, window.frames[ 'likes-master' ] );

					if ( $wrapper.hasClass( 'slim-likes-widget' ) ) {
						$wrapper.find( 'iframe' ).Jetpack( 'resizeable' );
					}
				});
				setTimeout( JetpackLikesWidgetQueueHandler, 250 );
			}
			JetpackLikesWidgetQueueHandler();
		//]]>
		</script>
<script type='text/javascript' src='https://s0.wp.com/_static/??/wp-content/js/devicepx.js,/wp-includes/js/comment-reply.min.js?m=1389017300j'></script>
<script type="text/javascript">
// <![CDATA[
(function() {
try{
  if ( window.external &&'msIsSiteMode' in window.external) {
    if (window.external.msIsSiteMode()) {
      var jl = document.createElement('script');
      jl.type='text/javascript';
      jl.async=true;
      jl.src='/wp-content/plugins/ie-sitemode/custom-jumplist.php';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(jl, s);
    }
  }
}catch(e){}
})();
// ]]>
</script><script src="https://ssl-stats.wordpress.com/w.js?21" type="text/javascript"></script>
<script type="text/javascript">
st_go({'blog':'10740073','v':'wpcom','tz':'0','user_id':'0','post':'357','subd':'perl6advent'});
ex_go({'crypt':'UE5XaGUuOTlwaD85flAmcm1mcmZsaDhkV11YdWFnNncxc1tjZG9XVXhReTFqanhKV3x0UkQxQldDVUV4ZVR+cSt8Ny8tTm40WDY2NUd1SH5CMko/Rmx6TmhYLjZfbC5sPyt8ckZTYU9yaVpETGV2THZsTDJBNC5qYWwvZElSMzR3ZGNrMWFzWHBrTz18JSVPSV8xbEdzUk4lQ2o2SFljckotS2ctbDAtWDNKZGhCTkxNdUFtcnBDP0MmOVJJWjg1OFQ5WXMxU2N5L1g5VkFZM3I3eSw3ZVtmR2omaDlzL0JvcVJXS0tERV9Uc2lGdW9taDgyaHdiMVVYWU94M2osKy55MC92ZCxjYVJhfEhjQWsuUmpEQlluaXVfaUdsT1No'});
addLoadEvent(function(){linktracker_init('10740073',357);});
	</script>
<noscript><img src="https://stats.wordpress.com/b.gif?v=noscript" style="height:0px;width:0px;overflow:hidden" alt="" /></noscript>
<script>
if ( 'object' === typeof wpcom_mobile_user_agent_info ) {

	wpcom_mobile_user_agent_info.init();
	var mobileStatsQueryString = "";
	
	if( false !== wpcom_mobile_user_agent_info.matchedPlatformName )
		mobileStatsQueryString += "&x_" + 'mobile_platforms' + '=' + wpcom_mobile_user_agent_info.matchedPlatformName;
	
	if( false !== wpcom_mobile_user_agent_info.matchedUserAgentName )
		mobileStatsQueryString += "&x_" + 'mobile_devices' + '=' + wpcom_mobile_user_agent_info.matchedUserAgentName;
	
	if( wpcom_mobile_user_agent_info.isIPad() )
		mobileStatsQueryString += "&x_" + 'ipad_views' + '=' + 'views';

	if( "" != mobileStatsQueryString ) {
		new Image().src = document.location.protocol + '//stats.wordpress.com/g.gif?v=wpcom-no-pv' + mobileStatsQueryString + '&baba=' + Math.random();
	}
	
}
</script></body>
</html>
