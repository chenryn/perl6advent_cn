	<div class="post" id="post-2799">
		<h2>2010年Perl6圣诞月历(廿一)翻译以及其他~</h2>
		<div class="info">
			<span class="date">2011年12月15日</span>
			<span class="author"><a href="http://chenlinux.com/author/admin" title="由 admin 发布" rel="author">admin</a></span>
			
			
				<span class="addcomment"><a href="#respond">发表评论</a></span>
				<span class="comments"><a href="#comments">阅读评论</a></span>
			
			<div class="fixed"></div>
		</div>
		<div class="content">
			<p>翻译(Transliteration)一听就像是有一个拉丁文的词根，然后开始转换字母。嗯，这就是Str.trans方法要做的。</p>
<div class="wp_syntax"><div class="code"><pre class="perl" style="font-family:monospace;">say <span style="color: #ff0000;">&quot;GATTACA&quot;</span><span style="color: #339933;">.</span>trans<span style="color: #009900;">&#40;</span> <span style="color: #ff0000;">&quot;TCAG&quot;</span> <span style="color: #339933;">=&gt;</span> <span style="color: #ff0000;">&quot;0123&quot;</span> <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>  <span style="color: #666666; font-style: italic;"># prints &quot;3200212\n&quot;</span></pre></div></div>
<p>写shell或者perl5的童鞋可能马上想到了tr/tcag/0123/这个写法。这里快速的解释一下trans：我们把字符串里每一个T换成0，每一个C换成1……也就是说，这两个TCAG和0123是会分成一个一个字母的进行替换的。<br />
这可以用来做一些很节省时间的事情。比如，下面是一个用回转13位法加密文本的例子：</p>
<div class="wp_syntax"><div class="code"><pre class="perl" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">sub</span> rot13<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$text</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> <span style="color: #0000ff;">$text</span><span style="color: #339933;">.</span>trans<span style="color: #009900;">&#40;</span> <span style="color: #ff0000;">&quot;A..Za..z&quot;</span> <span style="color: #339933;">=&gt;</span> <span style="color: #ff0000;">&quot;N..ZA..Mn..za..m&quot;</span> <span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#125;</span></pre></div></div>
<p>当.trans看到..操作符的时候，会自动展开（比如把n..z变成nopqrstuvwxyz）。所以，回转13位加密法的最终结果就是转换一部分字母成刚好相反的另一部分。<br />
在Perl5里，两个点..只是一个破折号-的概念。在Perl6里，我们准备扩展成范围(range)的概念。不管是主程序、正则表达式，还是翻译语句里。<br />
同时你可以注意到：.trans方法不会改变$text变量本身的值，而是返回一个新的值。这也是Perl6中的普遍做法。在Perl6的主核里，我们更偏向提供这些没副作用的方法。当然你只要稍微修改一点点，写成.=trans，就可以直接改变变量本身了。</p>
<div class="wp_syntax"><div class="code"><pre class="perl" style="font-family:monospace;"><span style="color: #0000ff;">$kabbala</span><span style="color: #339933;">.=</span>trans<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;A..Ia..i&quot;</span> <span style="color: #339933;">=&gt;</span> <span style="color: #ff0000;">&quot;1..91..9&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></div>
<p>(这个用法同样也不是.trans唯一的，所有的方法都可以这么用。意在鼓励程序员们采用非变更的方式编写自己的库，世界都会美好很多的^-^)<br />
如果Perl6的.trans技止于此，那Perl6还不如叫回Perl5得了~继续看示例：</p>
<div class="wp_syntax"><div class="code"><pre class="perl" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">#当你要写一个html页的时候，肯定需要这么个转换吧</span>
    <span style="color: #339933;">&amp;</span> <span style="color: #339933;">=&gt;</span> <span style="color: #0000ff;">&amp;amp</span><span style="color: #339933;">;</span>
    <span style="color: #339933;">&lt;</span> <span style="color: #339933;">=&gt;</span> <span style="color: #0000ff;">&amp;lt</span><span style="color: #339933;">;</span>
    <span style="color: #339933;">&gt;</span> <span style="color: #339933;">=&gt;</span> <span style="color: #0000ff;">&amp;gt</span><span style="color: #339933;">;</span></pre></div></div>
<p>(顺便说一下：如果真是要写html了，我们有写好的库直接可以用。这里只是要你把握一个原则，当你要完成类似工作的是，Perl6已经内置了功能可以用的。)<br />
看起来不是一个简单的正则就能搞定的事情。为什么呢？以为替换前后都有一个&#038;，很可能会变成一个无限循环，就像这样：&#038;=>&amp;=>&&amp;=>&#038;&&amp;&#8230;你可能要写一大把代码来避免这种情况的发生了。<br />
事实上，这根本不是什么问题。这个需求的本质，是字符串的拼接，用不着拔高到思想的高度去。我们可不想要一个换下次序就不顶用的解决方案。好比说下面这个：</p>
<div class="wp_syntax"><div class="code"><pre class="perl" style="font-family:monospace;">    foo         <span style="color: #339933;">=&gt;</span> bar
    foolishness <span style="color: #339933;">=&gt;</span> folly</pre></div></div>
<p>匹配完第一个，后面这个就不会生效了——这可不行。所以一般情况下，我们会按照先长后短的方式书写。<br />
总之，我们需要的是一个最长标记的替换匹配，这样才不会导致无限循环的错误。<br />
而这就是Perl6的.trans提供的！真正的杀手锏：提供一对数组，而不单单是字符串。比如这个HTML的转义需求，我们只需要这么写就可以了：</p>
<div class="wp_syntax"><div class="code"><pre class="perl" style="font-family:monospace;"><span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$escaped</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">$html</span><span style="color: #339933;">.</span>trans<span style="color: #009900;">&#40;</span>
    <span style="color: #009900;">&#91;</span> <span style="color: #ff0000;">'&amp;'</span><span style="color: #339933;">,</span>     <span style="color: #ff0000;">'&lt;'</span><span style="color: #339933;">,</span>    <span style="color: #ff0000;">'&gt;'</span>    <span style="color: #009900;">&#93;</span> <span style="color: #339933;">=&gt;</span>
    <span style="color: #009900;">&#91;</span> <span style="color: #ff0000;">'&amp;amp;'</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">'&amp;lt;'</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">'&amp;gt;'</span> <span style="color: #009900;">&#93;</span>
<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></div>
<p>perl6会按照正确的顺序进行替换，绝对没有什么循环的麻烦。享受吧~~</p>
<div id="downaspdf">
                    <a title="下载此文章的 PDF 文档" href="http://chenlinux.com/wp-content/plugins/down-as-pdf/generate.php?id=2799">
                      <span>Download as PDF</span>
                    </a>
                </div>
			<div class="fixed"></div>
		</div>
		<div class="under">
			<span class="categories">分类: </span><span><a href="http://chenlinux.com/category/ops/script" title="查看 脚本 中的全部文章" rel="category tag">脚本</a></span>
			<span class="tags">标签: </span><span><a href="http://chenlinux.com/tag/perl" rel="tag">perl</a>, <a href="http://chenlinux.com/tag/perl6advent" rel="tag">perl6advent</a></span>
		</div>
	</div>
