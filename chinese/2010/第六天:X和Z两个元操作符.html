	<div class="post" id="post-2735">
		<h2>2010年Perl6圣诞月历(六)X和Z两个元操作符</h2>
		<div class="info">
			<span class="date">2011年12月13日</span>
			<span class="author"><a href="http://chenlinux.com/author/admin" title="由 admin 发布" rel="author">admin</a></span>
			
			
				<span class="addcomment"><a href="#respond">发表评论</a></span>
				<span class="comments"><a href="#comments">阅读评论</a></span>
			
			<div class="fixed"></div>
		</div>
		<div class="content">
			<p>Perl6中一个新的想法就是元操作符。一个操作符与另一个普通操作符结合到一起，以改变操作符的行为。在本文中，我们只介绍这些元操作符中的X和Z。<br />
X操作符大家应该已经熟悉他在交缀组合中的运用了——也就是把每个元素都提取组合一遍：</p>
<div class="wp_syntax"><div class="code"><pre class="perl" style="font-family:monospace;"><span style="color: #339933;">&gt;</span> say <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span> X <span style="color: #009900;">&#40;</span><span style="color: #ff0000;">'a'</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">'b'</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span>perl
<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;a&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;b&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;a&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;b&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span></pre></div></div>
<p>不过，这个中缀操作符X，其实只是元操作符X与列表连接操作符,的结合体的简写而已。也就是说，你完全可以完整的写成这个样子：</p>
<div class="wp_syntax"><div class="code"><pre class="perl" style="font-family:monospace;"><span style="color: #339933;">&gt;</span> say <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span> X<span style="color: #339933;">,</span> <span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">10</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">11</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span>perl
<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">10</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">11</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">10</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">11</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span></pre></div></div>
<p>那么把X和其他操作符写一块会怎么样呢？我们来试试中缀操作符+吧：</p>
<div class="wp_syntax"><div class="code"><pre class="perl" style="font-family:monospace;"><span style="color: #339933;">&gt;</span> say <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span> X<span style="color: #339933;">+</span> <span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">10</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">11</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span>perl
<span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">11</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">12</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">12</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">13</span><span style="color: #009900;">&#41;</span></pre></div></div>
<p>哈哈，你看，返回的不是一个个元素组成的列表，操作符加上了新的效果，不再返回列表而是直接返回加法的和了！<br />
这个适用于你能用的各种操作符。比如字符串连接中缀操作符~</p>
<div class="wp_syntax"><div class="code"><pre class="perl" style="font-family:monospace;"><span style="color: #339933;">&gt;</span> say <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span> X<span style="color: #339933;">~</span> <span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">10</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">11</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span>perl
<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;110&quot;</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;111&quot;</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;210&quot;</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;211&quot;</span><span style="color: #009900;">&#41;</span></pre></div></div>
<p>甚至数值比较操作符==</p>
<div class="wp_syntax"><div class="code"><pre class="perl" style="font-family:monospace;"><span style="color: #339933;">&gt;</span> say <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span> X<span style="color: #339933;">==</span> <span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span>perl
<span style="color: #009900;">&#40;</span>Bool<span style="color: #339933;">::</span><span style="color: #006600;">True</span><span style="color: #339933;">,</span> Bool<span style="color: #339933;">::</span><span style="color: #006600;">True</span><span style="color: #339933;">,</span> Bool<span style="color: #339933;">::</span><span style="color: #006600;">False</span><span style="color: #339933;">,</span> Bool<span style="color: #339933;">::</span><span style="color: #006600;">False</span><span style="color: #009900;">&#41;</span></pre></div></div>
<p>嗯，然后本文还要讲解的是Z操作符。希望你们已经了解过这个操作符是干嘛滴啦。如果您是一位Haskell程序员，并且把中缀操作符Z理解成zip函数，那么元操作符Z，就是zipWith函数了。</p>
<div class="wp_syntax"><div class="code"><pre class="perl" style="font-family:monospace;"><span style="color: #339933;">&gt;</span> say <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span> Z<span style="color: #339933;">,</span> <span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">3</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">4</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span>perl
<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">3</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">4</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">#41;</span>
<span style="color: #339933;">&gt;</span> say <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span> Z<span style="color: #339933;">+</span> <span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">3</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">4</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span>perl
<span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">4</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">6</span><span style="color: #009900;">&#41;</span>
<span style="color: #339933;">&gt;</span> say <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span> Z<span style="color: #339933;">==</span> <span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span>perl
<span style="color: #009900;">&#40;</span>Bool<span style="color: #339933;">::</span><span style="color: #006600;">True</span><span style="color: #339933;">,</span> Bool<span style="color: #339933;">::</span><span style="color: #006600;">False</span><span style="color: #009900;">&#41;</span></pre></div></div>
<p>Z操作符，会按照相同的次序，从每个列表里取出每一个元素，同时操作第一个、第二个、第三个……直到某个列表结束。<br />
而且Z操作符可以作用于无限序列，它会一直跑下去。而X操作符只能处理左侧无限的序列。<br />
我在写本文的时候，Rakudo处理中缀操作符Z和Z,时还出了个bug：前者返回了一个扁平的结果列表，后者才是对的。<br />
这些元操作符在对多个列表的各个元素进行操作的时候有着重大的作用。通过Z索引关联的方式，或者通过X插件所有的组合……<br />
比如你有@key和@value两个数组，要组合成一个hash，怎么做？容易！</p>
<div class="wp_syntax"><div class="code"><pre class="perl" style="font-family:monospace;"><span style="color: #b1b100;">my</span> <span style="color: #0000ff;">%hash</span> <span style="color: #339933;">=</span> <span style="color: #339933;">@</span><span style="color: #000066;">keys</span> Z<span style="color: #339933;">=&gt;</span> <span style="color: #339933;">@</span><span style="color: #000066;">values</span><span style="color: #339933;">;</span></pre></div></div>
<p>又或者你想并行遍历两个列表：</p>
<div class="wp_syntax"><div class="code"><pre class="perl" style="font-family:monospace;"><span style="color: #b1b100;">for</span> <span style="color: #0000ff;">@a</span> Z <span style="color: #0000ff;">@b</span> <span style="color: #339933;">-&gt;</span> <span style="color: #0000ff;">$a</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">$b</span> <span style="color: #009900;">&#123;</span> <span style="color: #339933;">...</span> <span style="color: #009900;">&#125;</span></pre></div></div>
<p>甚至三个列表：</p>
<div class="wp_syntax"><div class="code"><pre class="perl" style="font-family:monospace;"><span style="color: #b1b100;">for</span> <span style="color: #0000ff;">@a</span> Z <span style="color: #0000ff;">@b</span> Z <span style="color: #0000ff;">@c</span> <span style="color: #339933;">-&gt;</span> <span style="color: #0000ff;">$a</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">$b</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">$c</span> <span style="color: #009900;">&#123;</span> <span style="color: #339933;">...</span> <span style="color: #009900;">&#125;</span></pre></div></div>
<p>又或者当你掷3个10面骰子的时候，你想列出所有可能的骰子总数：</p>
<div class="wp_syntax"><div class="code"><pre class="perl" style="font-family:monospace;"><span style="color: #b1b100;">my</span> <span style="color: #0000ff;">@d10</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">1</span> <span style="color: #339933;">...</span> <span style="color: #cc66cc;">10</span><span style="color: #339933;">;</span>
<span style="color: #b1b100;">my</span> <span style="color: #0000ff;">@scores</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">@d10</span> X<span style="color: #339933;">+</span> <span style="color: #0000ff;">@d10</span><span style="color: #009900;">&#41;</span> X<span style="color: #339933;">+</span> <span style="color: #0000ff;">@d10</span><span style="color: #339933;">;</span></pre></div></div>
<p>如果你想找到一些更实际的运用，可以看看<a href="https://github.com/moritz/perl6-Sudoku/blob/master/lib/Sudoku.pm" title="Sudoku.pm" target="_blank">Sudoku.pm数独计算模块</a>。</p>
<div id="downaspdf">
                    <a title="下载此文章的 PDF 文档" href="http://chenlinux.com/wp-content/plugins/down-as-pdf/generate.php?id=2735">
                      <span>Download as PDF</span>
                    </a>
                </div>
			<div class="fixed"></div>
		</div>
		<div class="under">
			<span class="categories">分类: </span><span><a href="http://chenlinux.com/category/ops/script" title="查看 脚本 中的全部文章" rel="category tag">脚本</a></span>
			<span class="tags">标签: </span><span><a href="http://chenlinux.com/tag/perl" rel="tag">perl</a>, <a href="http://chenlinux.com/tag/perl6advent" rel="tag">perl6advent</a></span>
		</div>
	</div>
