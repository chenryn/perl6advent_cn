	<div class="post" id="post-2742">
		<h2>2010年Perl6圣诞月历(八)不同东西用不同名字</h2>
		<div class="info">
			<span class="date">2011年12月13日</span>
			<span class="author"><a href="http://chenlinux.com/author/admin" title="由 admin 发布" rel="author">admin</a></span>
			
			
				<span class="addcomment"><a href="#respond">发表评论</a></span>
				<span class="comments"><a href="#comments">阅读评论</a></span>
			
			<div class="fixed"></div>
		</div>
		<div class="content">
			<p>Perl5的新手们，总会很奇怪的说为啥自己没法倒装呢？Perl里有内置的reverse命令，但好像压根不起作用啊：</p>
<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;"> $ <span style="color: #c20cb9; font-weight: bold;">perl</span> <span style="color: #660033;">-E</span> <span style="color: #ff0000;">&quot;say reverse 'hello'&quot;</span>
    hello</pre></div></div>
<p>当他们去问一些有经验的perler的时候，解决办法很快就有了。因为reverse有两种操作模式，分别工作在标量和列表环境下，用来倒装字符串和列表元素：</p>
<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">$ <span style="color: #c20cb9; font-weight: bold;">perl</span> <span style="color: #660033;">-E</span> <span style="color: #ff0000;">&quot;say scalar reverse 'hello'&quot;</span>
    olleh</pre></div></div>
<p>比较悲剧的是这个情况和大多数的perl语境是不一致的。比方说，绝大多数的操作符和函数由自己决定语境，并在这个语境下分析数据。好比+和*作用于数字，.作用于字符串。所以说他们代表一个操作并且提供语境，而reverse却不是。<br />
在Perl6里，我们从过去的错误里吸取教训以摆脱历史的窘境。所以我们把列表倒叙，字符串翻转，哈希反演分开成了三个操作：</p>
<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;"><span style="color: #666666; font-style: italic;"># 字符串翻转，改名叫flip</span>
    $ perl6 <span style="color: #660033;">-e</span> <span style="color: #ff0000;">'say flip &quot;hello&quot;'</span>
    olleh
    <span style="color: #666666; font-style: italic;"># 列表倒叙</span>
    $ perl6 <span style="color: #660033;">-e</span> <span style="color: #ff0000;">'say join &quot;, &quot;, reverse &lt;ab cd ef&gt;'</span>
    ef, <span style="color: #7a0874; font-weight: bold;">cd</span>, ab
    <span style="color: #666666; font-style: italic;"># 哈希反演，叫invert</span>
    $ perl6 <span style="color: #660033;">-e</span> <span style="color: #ff0000;">'my %capitals = France =&gt; &quot;Paris&quot;, UK =&gt; &quot;London&quot;;
              say %capitals.invert.perl'</span>
    <span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">&quot;Paris&quot;</span> =<span style="color: #000000; font-weight: bold;">&gt;</span> <span style="color: #ff0000;">&quot;France&quot;</span>, <span style="color: #ff0000;">&quot;London&quot;</span> =<span style="color: #000000; font-weight: bold;">&gt;</span> <span style="color: #ff0000;">&quot;UK&quot;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span></pre></div></div>
<p>注意哈希的反演和其他两个不同。因为哈希的值不要求是唯一的，所以反演后，哈希结构可能会被改变，或者某些值被覆盖……<br />
如果必要的话，使用者可以自己决定返回哈希结构时的操作方式。比如下面就是一种无损的方式：</p>
<div class="wp_syntax"><div class="code"><pre class="perl" style="font-family:monospace;"><span style="color: #b1b100;">my</span> <span style="color: #0000ff;">%inverse</span><span style="color: #339933;">;</span>
    <span style="color: #0000ff;">%inverse</span><span style="color: #339933;">.</span><span style="color: #000066;">push</span><span style="color: #009900;">&#40;</span> <span style="color: #0000ff;">%original</span><span style="color: #339933;">.</span>invert <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></div>
<p>这个方法会在键值对存在的情况下，把新值push在原有值的队尾变成一个数组：</p>
<div class="wp_syntax"><div class="code"><pre class="perl" style="font-family:monospace;">    <span style="color: #b1b100;">my</span> <span style="color: #0000ff;">%h</span><span style="color: #339933;">;</span>
    <span style="color: #0000ff;">%h</span><span style="color: #339933;">.</span><span style="color: #000066;">push</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">'foo'</span> <span style="color: #339933;">=&gt;</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>    <span style="color: #666666; font-style: italic;"># foo =&gt; 1</span>
    <span style="color: #0000ff;">%h</span><span style="color: #339933;">.</span><span style="color: #000066;">push</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">'foo'</span> <span style="color: #339933;">=&gt;</span> <span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>    <span style="color: #666666; font-style: italic;"># foo =&gt; [1, 2]</span>
    <span style="color: #0000ff;">%h</span><span style="color: #339933;">.</span><span style="color: #000066;">push</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">'foo'</span> <span style="color: #339933;">=&gt;</span> <span style="color: #cc66cc;">3</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>    <span style="color: #666666; font-style: italic;"># foo =&gt; [1, 2, 3]</span></pre></div></div>
<p>这三个函数，都会强制转换他们的参数。也就是说，如果你传递一个列表给flip，这个列表会被强制成字符串后再翻转返回。</p>
<div id="downaspdf">
                    <a title="下载此文章的 PDF 文档" href="http://chenlinux.com/wp-content/plugins/down-as-pdf/generate.php?id=2742">
                      <span>Download as PDF</span>
                    </a>
                </div>
			<div class="fixed"></div>
		</div>
		<div class="under">
			<span class="categories">分类: </span><span><a href="http://chenlinux.com/category/ops/script" title="查看 脚本 中的全部文章" rel="category tag">脚本</a></span>
			<span class="tags">标签: </span><span><a href="http://chenlinux.com/tag/perl" rel="tag">perl</a>, <a href="http://chenlinux.com/tag/perl6advent" rel="tag">perl6advent</a></span>
		</div>
	</div>
