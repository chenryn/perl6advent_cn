




	<div class="post" id="post-2722">


		<h2>2010年Perl6圣诞月历(二)用main函数控制命令行交互</h2>


		<div class="info">


			<span class="date">2011年12月13日</span>


			<span class="author"><a href="http://chenlinux.com/author/admin" title="由 admin 发布" rel="author">admin</a></span>

			

			

				<span class="addcomment"><a href="#respond">发表评论</a></span>


				<span class="comments"><a href="#comments">阅读评论</a></span>


			

			<div class="fixed"></div>


		</div>


		<div class="content">


			<p>在UNIX环境下，很多脚本都是要从命令行里获取运行参数的。Perl6上，实现这个相当简单~比如下面这样：</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">$ <span style="color: #c20cb9; font-weight: bold;">cat</span> add.pl
    sub MAIN<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #007800;">$x</span>, <span style="color: #007800;">$y</span><span style="color: #7a0874; font-weight: bold;">&#41;</span> <span style="color: #7a0874; font-weight: bold;">&#123;</span>
        say <span style="color: #007800;">$x</span> + <span style="color: #007800;">$y</span>
    <span style="color: #7a0874; font-weight: bold;">&#125;</span>
    $ perl6 add.pl <span style="color: #000000;">3</span> <span style="color: #000000;">4</span>
    <span style="color: #000000;">7</span>
    $ perl6 add.pl too many arguments
    Usage:
    add.pl x y</pre></div></div>

<p>只要定义一个带命名变量的MAIN函数，你就可以获得命令行分析器一个。然后命令行参数就被自动绑定到$x和$y上了。如果不匹配，还有温馨的Usage提示~~<br />
当然，你可能更喜欢自己定制Usage信息。那么自己动手，编写USAGE函数好了：</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">    $ <span style="color: #c20cb9; font-weight: bold;">cat</span> add2.pl
    sub MAIN<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #007800;">$x</span>, <span style="color: #007800;">$y</span><span style="color: #7a0874; font-weight: bold;">&#41;</span> <span style="color: #7a0874; font-weight: bold;">&#123;</span>
        say <span style="color: #007800;">$x</span> + <span style="color: #007800;">$y</span>
    <span style="color: #7a0874; font-weight: bold;">&#125;</span>
    sub USAGE<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span> <span style="color: #7a0874; font-weight: bold;">&#123;</span>
        say <span style="color: #ff0000;">&quot;Usage: add.pl &lt;num1&gt; &lt;num2&gt;&quot;</span>;
    <span style="color: #7a0874; font-weight: bold;">&#125;</span>
    $ perl6 add2.pl too many arguments
    Usage: add.pl <span style="color: #000000; font-weight: bold;">&lt;</span>num1<span style="color: #000000; font-weight: bold;">&gt;</span> <span style="color: #000000; font-weight: bold;">&lt;</span>num2<span style="color: #000000; font-weight: bold;">&gt;</span></pre></div></div>

<p>更进一步的，你可以用multi指令声明多种MAIN函数以完成一种可替代的语法，或者根据某些常量做出不同反应，比如：</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">$ <span style="color: #c20cb9; font-weight: bold;">cat</span> calc
    <span style="color: #666666; font-style: italic;">#!/usr/bin/env perl6</span>
    multi MAIN<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">'add'</span>, <span style="color: #007800;">$x</span>, <span style="color: #007800;">$y</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>  <span style="color: #7a0874; font-weight: bold;">&#123;</span> say <span style="color: #007800;">$x</span> + <span style="color: #007800;">$y</span> <span style="color: #7a0874; font-weight: bold;">&#125;</span>
    multi MAIN<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">'div'</span>, <span style="color: #007800;">$x</span>, <span style="color: #007800;">$y</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>  <span style="color: #7a0874; font-weight: bold;">&#123;</span> say <span style="color: #007800;">$x</span> <span style="color: #000000; font-weight: bold;">/</span> <span style="color: #007800;">$y</span> <span style="color: #7a0874; font-weight: bold;">&#125;</span>
    multi MAIN<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">'mult'</span>, <span style="color: #007800;">$x</span>, <span style="color: #007800;">$y</span><span style="color: #7a0874; font-weight: bold;">&#41;</span> <span style="color: #7a0874; font-weight: bold;">&#123;</span> say <span style="color: #007800;">$x</span> <span style="color: #000000; font-weight: bold;">*</span> <span style="color: #007800;">$y</span> <span style="color: #7a0874; font-weight: bold;">&#125;</span>
    $ .<span style="color: #000000; font-weight: bold;">/</span>calc add <span style="color: #000000;">3</span> <span style="color: #000000;">5</span>
    <span style="color: #000000;">8</span>
    $ .<span style="color: #000000; font-weight: bold;">/</span>calc mult <span style="color: #000000;">3</span> <span style="color: #000000;">5</span>
    <span style="color: #000000;">15</span>
    $ .<span style="color: #000000; font-weight: bold;">/</span>calc
    Usage:
    .<span style="color: #000000; font-weight: bold;">/</span>calc add x y
    or
    .<span style="color: #000000; font-weight: bold;">/</span>calc div x y
    or
    .<span style="color: #000000; font-weight: bold;">/</span>calc mult x y</pre></div></div>

<p>还有命名参数对应不同的选项的情况：</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">$ <span style="color: #c20cb9; font-weight: bold;">cat</span> copy.pl
    sub MAIN<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #007800;">$source</span>, <span style="color: #007800;">$target</span>, Bool :<span style="color: #007800;">$verbose</span><span style="color: #7a0874; font-weight: bold;">&#41;</span> <span style="color: #7a0874; font-weight: bold;">&#123;</span>
        say <span style="color: #ff0000;">&quot;Copying '<span style="color: #007800;">$source</span>' to '<span style="color: #007800;">$target</span>'&quot;</span> <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #007800;">$verbose</span>;
        run <span style="color: #ff0000;">&quot;cp <span style="color: #007800;">$source</span> <span style="color: #007800;">$target</span>&quot;</span>;
    <span style="color: #7a0874; font-weight: bold;">&#125;</span>
    $ perl6 copy.pl calc calc2
    $ perl6 copy.pl  <span style="color: #660033;">--verbose</span> calc calc2
    Copying <span style="color: #ff0000;">'calc'</span> to <span style="color: #ff0000;">'calc2'</span></pre></div></div>

<p>这里申明变量$verbose类型为Bool，也就是不接受赋值。如果没有这个类型约束的话，它是需要赋值的，就像下面这样：</p>

<div class="wp_syntax"><div class="code"><pre class="perl" style="font-family:monospace;">$ cat do<span style="color: #339933;">-</span>nothing<span style="color: #339933;">.</span>pl
    <span style="color: #000000; font-weight: bold;">sub</span> MAIN<span style="color: #009900;">&#40;</span><span style="color: #339933;">:</span><span style="color: #0000ff;">$how</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">'fast'</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
        say <span style="color: #ff0000;">&quot;Do nothing, but do it $how&quot;</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
    $ perl6 do<span style="color: #339933;">-</span>nothing<span style="color: #339933;">.</span>pl
    Do nothing<span style="color: #339933;">,</span> but <span style="color: #b1b100;">do</span> it fast
    $ perl6 do<span style="color: #339933;">-</span>nothing<span style="color: #339933;">.</span>pl <span style="color: #339933;">--</span>how<span style="color: #339933;">=</span>well
    Do nothing<span style="color: #339933;">,</span> but <span style="color: #b1b100;">do</span> it well
    $ perl6 do<span style="color: #339933;">-</span>nothing<span style="color: #339933;">.</span>pl what<span style="color: #339933;">?</span>
    Usage<span style="color: #339933;">:</span>
    do<span style="color: #339933;">-</span>nothing<span style="color: #339933;">.</span>pl <span style="color: #009900;">&#91;</span><span style="color: #339933;">--</span>how<span style="color: #339933;">=</span>value<span style="color: #339933;">-</span>of<span style="color: #339933;">-</span>how<span style="color: #009900;">&#93;</span></pre></div></div>

<p>总之，Perl6提供了内置的命令行解析功能和使用帮助说明，你只要声明好函数就行了。</p>
<div id="downaspdf">
                    <a title="下载此文章的 PDF 文档" href="http://chenlinux.com/wp-content/plugins/down-as-pdf/generate.php?id=2722">
                      <span>Download as PDF</span>
                    </a>
                </div>

			<div class="fixed"></div>


		</div>


		<div class="under">


			<span class="categories">分类: </span><span><a href="http://chenlinux.com/category/ops/script" title="查看 脚本 中的全部文章" rel="category tag">脚本</a></span>

			<span class="tags">标签: </span><span><a href="http://chenlinux.com/tag/perl" rel="tag">perl</a>, <a href="http://chenlinux.com/tag/perl6advent" rel="tag">perl6advent</a></span>

		</div>


	</div>





